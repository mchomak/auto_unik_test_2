(()=>{"use strict";var e,t,a={11:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.initCommonSettings=void 0;const s=i(a(8924));t.initCommonSettings=async function(e){const t=new s.default;await t.init(e.bus)}},95:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isAuthData=void 0;const i=a(7744),s=a(5643),n=a(2166);t.isAuthData=function(e){return(0,i.isObject)(e)&&(0,s.hasStringProperty)(e,"accessToken")&&(0,s.hasStringProperty)(e,"refreshToken")&&(0,n.hasBooleanProperty)(e,"shortLived")}},111:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.bindFeatureFlagServiceToBus=t.FeatureFlagService=void 0;const s=a(3023),n=a(2159),r=i(a(8030));t.FeatureFlagService=class{constructor(e,t){this.flagStorage=e,this.flagsApi=t}async isEnabled(e){if(e.isLocal)return e.isEnabled??!1;const t=await this.getFlagData(e);return t?.enabled??!1}async getFlagData(e){const t=await this.getFlagsData();if(null==t)return null;const a=t.flags.find(t=>t.name===e.name);if(a){if((Date.now()-t.lastUpdate)/1e3>=a.ttl){const t=await this.updateFlagsFromRemote();if(null!=t){const a=t?.flags.find(t=>t.name===e.name);return a??null}}return a}return null}async getFlagsData(){const e=await this.flagStorage.get();if(null==e)return await this.updateFlagsFromRemote();if((Date.now()-e.lastUpdate)/1e3>e.ttl){const e=await this.updateFlagsFromRemote();if(null!=e)return e}return e}async updateFlagsFromRemote(){const e=(await(0,n.runCatching)(()=>this.flagsApi.getFeatureFlags())).getOrNull();if(null==e)return null;{const t={flags:e.flags,ttl:e.ttl,lastUpdate:Date.now()};return await this.flagStorage.set(t),t}}},t.bindFeatureFlagServiceToBus=function(e,t){e.bind(r.default.IsEnabled,s.isFeatureFlag,e=>(0,n.runCatching)(()=>t.isEnabled(e)))}},325:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createTypeGuard=void 0,t.createTypeGuard=function(e){return e}},430:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isNumberOrNull=void 0,t.isNumberOrNull=function(e){return"number"==typeof e||null==e}},483:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CachingPersistentStorage=void 0;const i=a(8674),s=a(9789);class n extends i.LocalStorage{constructor(e,t){super(e,t),this.inMemoryStorage=new s.InMemoryStorage(e)}async get(){const e=await this.inMemoryStorage.get();return null!=e?e:super.get()}async set(e){await super.set(e),await this.inMemoryStorage.set(e)}async clear(){await super.clear(),await this.inMemoryStorage.clear()}}t.CachingPersistentStorage=n},919:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.FeatureFlagServiceBackground=void 0;const s=i(a(8030)),n=a(2159);t.FeatureFlagServiceBackground=class{constructor(e){this.bus=e}async isEnabled(e){return(0,n.toResult)(await this.bus.publishLocally(s.default.IsEnabled,e)).getOrThrow()}}},1081:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.BusModule=void 0;const s=i(a(1857));t.BusModule={bus:s.default.getInstance()}},1399:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isBoardTableData=void 0;const i=a(4456),s=a(7744),n=a(8267);t.isBoardTableData=function(e){return(0,s.isObject)(e)&&"quizMeta"in e&&(0,i.isPageData)(e.quizMeta)&&(0,n.hasStringOrNullProperty)(e,"tableHtml")}},1422:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isLocalSolutionRequest=void 0;const i=a(4456),s=a(7744),n=a(5643),r=a(1791);t.isLocalSolutionRequest=function(e){return(0,s.isObject)(e)&&"quizMeta"in e&&(0,i.isPageData)(e.quizMeta)&&(0,r.hasNumberOrNullProperty)(e,"questionId")&&(0,n.hasStringProperty)(e,"questionIdentity")&&(0,n.hasStringProperty)(e,"questionType")}},1547:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isQuizMeta=void 0;const i=a(7744);t.isQuizMeta=function(e){return(0,i.isObject)(e)&&"host"in e&&"courseId"in e&&"courseName"in e&&"quizId"in e&&"quizName"in e&&"attemptId"in e}},1579:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isReviewData=void 0;const i=a(2310);t.isReviewData=function(e){return(0,i.isAttemptData)(e)&&"reviewSummary"in e&&("string"==typeof e.reviewSummary||null===e.reviewSummary)}},1791:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.hasNumberOrNullProperty=void 0;const i=a(430);t.hasNumberOrNullProperty=function(e,t){return t in e&&(0,i.isNumberOrNull)(e[t])}},1854:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=a(9977),s=a(3118),n=a(3352),r=a(2938),o=a(325),u=a(1080);class l extends n.ApiClient{constructor(e,t){super(e,s.defaultLogger.child("QuizApi")),this.authService=t}async getApiKeyHeader(){const e={},t=await this.authService.getAccessToken();return null!=t&&(e["X-Api-Key"]=t),e}async requestCompletion(e){return await this.fetchJsonCatching("v2/quiz/completion",{method:"GET",headers:await this.getApiKeyHeader(),queryParams:{...e},typeGuard:i.isCompletionData})}async requestSolution(e){return await this.fetchJsonCatching("v2/quiz/solution",{method:"GET",headers:await this.getApiKeyHeader(),queryParams:{...e},typeGuard:(0,o.createTypeGuard)(e=>(0,r.isArray)(e,u.isSolution))})??[]}async sendAttemptData(e){await this.fetchCatching("v2/quiz/attempt",{method:"POST",timeout:2e4,headers:await this.getApiKeyHeader(),objectBody:e})}async sendReviewData(e){await this.fetchCatching("v2/quiz/review",{method:"POST",timeout:2e4,headers:await this.getApiKeyHeader(),objectBody:e})}async sendBoardTableData(e){await this.fetchCatching("v2/quiz/attempt/summary",{method:"POST",timeout:2e4,headers:await this.getApiKeyHeader(),objectBody:e})}}t.default=l},1907:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.HttpError=void 0;class a extends Error{constructor(e,t){super(`HttpError: status '${e}', message '${t}'`),this.statusCode=e,this.statusMessage=t}}t.HttpError=a},1921:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=a(6720),s=a(3352),n=a(3118);class r extends s.ApiClient{constructor(e,t){super(e,n.defaultLogger.child("FeatureFlagsApi")),this.authService=t}async getApiKeyHeader(){const e={},t=await this.authService.getAccessToken();return null!=t&&(e["X-Api-Key"]=t),e}async getFeatureFlags(){return await this.fetchJson("v2/feature-flags",{timeout:2e3,method:"GET",headers:await this.getApiKeyHeader(),typeGuard:i.isRemoteFeatureFlagsData})}}t.default=r},2129:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FeatureFlagStorage=void 0;const i=a(6366),s=a(483);class n extends s.CachingPersistentStorage{constructor(){super(i.isFeatureFlagsData,"featureFlagsData")}}t.FeatureFlagStorage=n},2310:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isAttemptData=void 0;const i=a(7744),s=a(1547),n=a(2938),r=a(3793);t.isAttemptData=function(e){return(0,i.isObject)(e)&&"quizMeta"in e&&(0,s.isQuizMeta)(e.quizMeta)&&"questions"in e&&(0,n.isArray)(e.questions,r.isUnknown)}},2418:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.initRemoteLogsListener=void 0;const s=i(a(859)),n=a(3118),r=a(7670);t.initRemoteLogsListener=function(e){e.bus.listen(s.default.PushLogEntry,r.isStorageLogEvent,e=>{try{n.storageTransport.storageLog(e)}catch{}})}},2666:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isUserData=void 0;const i=a(7744),s=a(5643),n=a(2166);t.isUserData=function(e){return(0,i.isObject)(e)&&(0,s.hasStringProperty)(e,"username")&&(0,n.hasBooleanProperty)(e,"plus_edition")}},2893:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isStatusInfo=void 0;const i=a(7744);t.isStatusInfo=function(e){return(0,i.isObject)(e)&&"maintenance"in e&&"boolean"==typeof e.maintenance&&"highDemand"in e&&"boolean"==typeof e.highDemand}},3023:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isFeatureFlag=void 0;const i=a(2166),s=a(7744),n=a(5643);t.isFeatureFlag=function(e){return(0,s.isObject)(e)&&(0,n.hasStringProperty)(e,"name")&&(0,i.hasBooleanProperty)(e,"isLocal")}},3352:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ApiClient=void 0;const s=i(a(4602)),n=a(5600),r=a(3118),o=a(2946),u=a(2159),l=a(7397),c=a(1907),d=a(4262);t.ApiClient=class{constructor(e,t=null){var a;this.baseUrl=(a=e).endsWith("/")?a.slice(0,-1):a,this.logger=t??r.defaultLogger.child("ApiClient"),this.logger.packet("Created.")}async fetch(e,t={}){let a=(i=e).startsWith("/")?i.slice(1):i;var i;let r=null;!0!==t.includeExtensionMeta&&void 0!==t.includeExtensionMeta||(r={...s.default}),void 0!==t.queryParams&&(r={...r,...t.queryParams}),null!==r&&(a=`${e}?${new URLSearchParams(r).toString()}`),t.objectBody&&(t.body=JSON.stringify(t.objectBody),t.headers={"Content-Type":"application/json",...t.headers??{}});const u=`${this.baseUrl}/${a}`;let d=null;try{d=await(0,n.fetchWithTimeout)(u,t)}catch(e){throw e instanceof Error?this.logger.error(`Fetch error: ${u}`,(0,o.extras)({error:e})):this.logger.error(`Unknown fetch error: ${u}`,(0,o.extras)({error:e})),e}if(401===d.status)throw this.logger.error(`Fetch error '${u}': unauthorized`),new l.UnauthorizedError;if(!d.ok)throw this.logger.error(`Fetch error '${u}': ${d.status} ${d.statusText}`),new c.HttpError(d.status,d.statusText);return d}async fetchJson(e,t={}){const a=await this.fetch(e,t),i=await a.json();if(this.logger.packet(`${e} response ${a.status}`,(0,o.extras)({json:i})),void 0!==t.typeGuard){if(t.typeGuard(i))return i;throw this.logger.error(`${e} type validation failed.`,(0,o.extras)({json:i})),new d.ValidationError}return i}async fetchCatching(e,t={}){return(await(0,u.runCatching)(()=>this.fetch(e,t))).getOrNull()}async fetchJsonCatching(e,t={}){return(await(0,u.runCatching)(()=>this.fetchJson(e,t))).getOrNull()}}},3401:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isMoodleData=void 0;const i=a(7744),s=a(5643);t.isMoodleData=function(e){return(0,i.isObject)(e)&&(0,s.hasStringProperty)(e,"moodle_user")&&(0,s.hasStringProperty)(e,"moodle_host")}},4024:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(859)),n=i(a(6815)),r=a(3109),o=a(3118),u=a(2946),l=o.defaultLogger.child("StatusMessage"),c={maintenance:{title:n.default.i18n.getMessage("maintenanceTitle"),content:n.default.i18n.getMessage("maintenanceContent"),construct:!0,keyboard:!1,backdrop:"static",headerClose:!1,buttons:[{text:n.default.i18n.getMessage("gotIt"),value:!1,attr:{class:"btn btn-primary","data-dismiss":"modal"}}]},highDemand:{title:n.default.i18n.getMessage("highDemandTitle"),content:n.default.i18n.getMessage("highDemandContent"),construct:!0,keyboard:!1,backdrop:"static",headerClose:!1,buttons:[{text:n.default.i18n.getMessage("Donate"),value:!0,tag:"url",data:"https://syncshare.naloaty.me/#donation",attr:{class:"btn btn-default","data-dismiss":"modal"}},{text:n.default.i18n.getMessage("gotIt"),value:!1,attr:{class:"btn btn-primary","data-dismiss":"modal"}}]},unreachable:{title:n.default.i18n.getMessage("serviceUnreachableTitle"),content:n.default.i18n.getMessage("serviceUnreachableContent"),construct:!0,keyboard:!1,backdrop:"static",headerClose:!1,buttons:[{text:n.default.i18n.getMessage("gotIt"),value:!1,attr:{class:"btn btn-primary","data-dismiss":"modal"}}]}};t.default=class{constructor(e){this.systemApi=e}async init(e){e.bind(s.default.GetStatusMessage,r.isNever,e=>this.getStatusMessage()),l.info("Initialized")}async getStatusMessage(){const e=await this.systemApi.getServiceStatus();return l.info("Got service status",(0,u.extras)({status:e})),null===e?c.unreachable:e.maintenance?c.maintenance:e.highDemand?c.highDemand:void 0}}},4152:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.initFeatureFlags=void 0;const s=a(2129),n=a(111),r=i(a(1921)),o=a(3118).defaultLogger.child("FeatureFlagService");t.initFeatureFlags=async function(e){o.info("Initializing...");const t=new s.FeatureFlagStorage,a=new r.default(e.serviceUrl,e.authService),i=new n.FeatureFlagService(t,a);return(0,n.bindFeatureFlagServiceToBus)(e.bus,i),o.info("Initialized"),{featureFlagService:i}}},4262:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ValidationError=void 0;class a extends Error{constructor(e){super(e)}}t.ValidationError=a},4392:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(859)),n=i(a(6815)),r=a(2310),o=a(1579),u=a(1422),l=a(1399),c=a(7669),d=a(3118),g=a(2946),h=d.defaultLogger.child("AttemptService");t.default=class{constructor(e){this.quizApi=e}async init(e){h.info("Initializing..."),n.default.runtime.onStartup.addListener(function(){n.default.storage.local.remove("attemptData"),n.default.storage.local.remove("magicButtonsState"),h.debug("Saved state invalidated"),n.default.storage.local.remove("attempts")}),e.bind(s.default.QuizAttemptData,r.isAttemptData,e=>{this.onAttemptData(e.quizMeta,e.questions)}),e.bind(s.default.QuizReviewData,o.isReviewData,e=>{this.onReviewData(e.quizMeta,e.questions,e.reviewSummary)}),e.bind(s.default.BoardTableData,l.isBoardTableData,e=>{this.onBoardTableData(e)}),e.bind(s.default.SolutionRequest,u.isLocalSolutionRequest,e=>this.onSolutionRequest(e)),e.bind(s.default.CompletionRequest,c.isLocalCompletionRequest,e=>this.onCompletionRequest(e)),h.info("Initialized")}onAttemptData(e,t){if(null===e.moodleId||null===e.host||null===e.courseId||null===e.courseName||null===e.quizId||null===e.quizName||null===e.attemptId)return void h.warn("Failed to send attempt data: some of the required properties are null.",(0,g.extras)({data:e}));const a={moodleId:e.moodleId,quizMeta:{host:e.host,courseId:e.courseId,courseName:e.courseName,quizId:e.quizId,quizName:e.quizName,attemptId:e.attemptId},questions:t};h.debug("Sent attempt data",(0,g.extras)({attemptData:a})),this.quizApi.sendAttemptData(a)}onReviewData(e,t,a){if(null===e.moodleId||null===e.host||null===e.courseId||null===e.courseName||null===e.quizId||null===e.quizName||null===e.attemptId)return void h.warn("Failed to send review data: some of the required properties are null.",(0,g.extras)({data:e}));const i={moodleId:e.moodleId,quizMeta:{host:e.host,courseId:e.courseId,courseName:e.courseName,quizId:e.quizId,quizName:e.quizName,attemptId:e.attemptId},questions:t,reviewSummary:a};h.debug("Sent review data",(0,g.extras)({reviewData:i})),this.quizApi.sendReviewData(i)}onBoardTableData(e){null!==e.quizMeta.moodleId&&null!==e.quizMeta.host&&null!==e.quizMeta.courseId&&null!==e.quizMeta.courseName&&null!==e.quizMeta.quizId&&null!==e.quizMeta.quizName&&null!==e.quizMeta.attemptId?this.quizApi.sendBoardTableData(e):h.warn("Failed to send board table data: some of the required properties are null.",(0,g.extras)({data:e}))}async onSolutionRequest(e){if(null===e.quizMeta.moodleId||null===e.quizMeta.host||null===e.quizMeta.courseId||null===e.quizMeta.quizId||null===e.quizMeta.attemptId)return void h.warn("Failed to request solution: some of the required properties are null.",(0,g.extras)({extras:g.extras}));const t={host:e.quizMeta.host,courseId:e.quizMeta.courseId.toString(),quizId:e.quizMeta.quizId.toString(),attemptId:e.quizMeta.attemptId.toString(),moodleId:e.quizMeta.moodleId.toString(),questionIdentity:e.questionIdentity,questionType:e.questionType};null!=e.questionId&&(t.questionId=e.questionId.toString()),h.debug("Sent solution request",(0,g.extras)({solutionRequest:t}));const a=await this.quizApi.requestSolution(t);return h.debug("Received solution",(0,g.extras)({solution:a})),a}async onCompletionRequest(e){const t={host:e.host,quizId:e.quizId.toString()};return await this.quizApi.requestCompletion(t)}}},4453:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SystemApi=void 0;const i=a(6426),s=a(2893),n=a(3352),r=a(3118);class o extends n.ApiClient{constructor(e){super(e,r.defaultLogger.child("SystemApi"))}async getServiceStatus(){return this.fetchJsonCatching("v2/status",{method:"GET",typeGuard:s.isStatusInfo})}async checkUpdate(){return this.fetchJsonCatching("v2/update",{method:"GET",typeGuard:i.isUpdateInfo})}}t.SystemApi=o},4456:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isPageData=void 0;const i=a(1547);t.isPageData=function(e){return(0,i.isQuizMeta)(e)&&"moodleId"in e}},4602:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default={client:"2.11.0"}},4804:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=a(8079),s=a(8277),n=a(3352),r=a(3118);class o extends n.ApiClient{constructor(e){super(e,r.defaultLogger.child("LoginApi"))}async login(e){return await this.fetchJson("v2/auth/login",{method:"POST",objectBody:{username:e.username,password:e.password,short_lived:e.hiddenMode},typeGuard:i.isLoginSchema})}async logout(e){await this.fetch("v2/auth/logout",{method:"POST",objectBody:{refresh_token:e}})}async refresh(e){return await this.fetchJson("v2/auth/refresh",{method:"POST",objectBody:{refresh_token:e},typeGuard:i.isLoginSchema})}async qrLogin(e){return await this.fetchJson("v2/auth/qr_login",{method:"POST",objectBody:{qr_data:e.qr_data,timeout:e.timeout,short_lived:e.hiddenMode},typeGuard:i.isLoginSchema})}async qrAuth(){return await this.fetchJson("v2/auth/qr_auth",{method:"GET",typeGuard:s.isQrDataSchema})}}t.default=o},4878:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.initAccountFeature=void 0;const s=a(5221),n=a(8894),r=i(a(4804)),o=a(8580),u=i(a(7174)),l=a(5107);t.initAccountFeature=async function(e){const t=new s.AuthStorage,a=new n.UserStorage,i=new r.default(e.accountsUrl),c=new o.AuthService(i,t),d=new u.default(e.accountsUrl,c),g=new l.AccountService(d,a);return(0,l.bindAccountServiceToBus)(e.bus,g),(0,o.bindAuthServiceToBus)(e.bus,c),{authService:c,accountService:g}}},4988:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.initPrivacyPolicyFeature=void 0;const s=i(a(6815)),n=a(7709),r=a(2946),o=a(3118).defaultLogger.child("PrivacyPolicy");t.initPrivacyPolicyFeature=function(){o.info("Initialized."),s.default.runtime.onInstalled.addListener(e=>{o.debug("onInstalled",(0,r.extras)({reason:e.reason})),"install"===e.reason?(o.info("Fresh installation detected. Consent page open."),(0,n.openPrivacyPolicyConsentPage)()):"update"===e.reason&&(o.info("Update installation detected."),s.default.storage.local.get({settings:{privacyPolicyAcceptedByUser:!1}}).then(e=>{e.settings.privacyPolicyAcceptedByUser||(o.info("No consent from user. Consent page open."),(0,n.openPrivacyPolicyConsentPage)())}))})}},4993:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(859)),n=i(a(6815)),r=a(3109),o=a(3118),u=a(2946),l=o.defaultLogger.child("UpdateMessage"),c={title:n.default.i18n.getMessage("updateAvailableTitle"),content:n.default.i18n.getMessage("updateAvailableContent"),construct:!0,keyboard:!1,backdrop:"static",headerClose:!1,buttons:[{text:n.default.i18n.getMessage("Update"),value:!0,tag:"url",data:"https://syncshare.naloaty.me/#install",attr:{class:"btn btn-primary","data-dismiss":"modal"}}]};t.default=class{constructor(e){this.systemApi=e}async init(e){e.bind(s.default.GetUpdateMessage,r.isNever,e=>this.getUpdateMessage()),l.info("Initialized")}async getUpdateMessage(){const e=await this.systemApi.checkUpdate();return null===e?null:(l.debug("Got update status",(0,u.extras)({update:e})),e.updateRequired?c:null)}}},5107:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.bindAccountServiceToBus=t.AccountService=void 0;const i=a(3401),s=a(3109),n=a(6539),r=a(2159);t.AccountService=class{constructor(e,t){this.api=e,this.userStorage=t}async getUserData(){const e=await this.userStorage.get();return null!=e?e:await this.api.getUserData()}async isBenefitsAvailable(e){const t=await this.api.getAccountEdition(e);return t.plus_edition&&!t.restricted}},t.bindAccountServiceToBus=function(e,t){e.bind(n.AccountServiceEvent.GetUserData,s.isNever,()=>(0,r.runCatching)(()=>t.getUserData())),e.bind(n.AccountServiceEvent.IsBenefitsAvailable,i.isMoodleData,e=>(0,r.runCatching)(()=>t.isBenefitsAvailable(e)))}},5221:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AuthStorage=void 0;const i=a(483),s=a(95);class n extends i.CachingPersistentStorage{constructor(){super(s.isAuthData,"authData")}}t.AuthStorage=n},5560:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.initQuizFeature=void 0;const s=i(a(1854)),n=i(a(4392)),r=i(a(6815)),o=a(919),u=a(3136),l=i(a(859)),c=i(a(6744));t.initQuizFeature=async function(e){const t=new s.default(e.serviceUrl,e.authService),a=new n.default(t),i=new o.FeatureFlagServiceBackground(e.bus),d=await i.isEnabled(u.FeatureFlags.QuizView);await a.init(e.bus),r.default.contextMenus.removeAll().then(()=>{d&&(r.default.contextMenus.create({id:c.default.QuizView,title:r.default.i18n.getMessage("openQuizViewMessage"),documentUrlPatterns:["*://*/*mod/quiz/view.php*"],contexts:["page"]}),r.default.contextMenus.onClicked.addListener((t,a)=>{t.menuItemId===c.default.QuizView&&a?.id&&e.bus.publishToTab(a.id,l.default.OpenQuizView)}))})}},5923:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.hasArrayProperty=void 0;const i=a(2938);t.hasArrayProperty=function(e,t,a){return t in e&&(0,i.isArray)(e[t],a)}},6366:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isFeatureFlagsData=t.isFeatureFlagData=void 0;const i=a(5923),s=a(2166),n=a(3735),r=a(7744),o=a(5643);function u(e){return(0,r.isObject)(e)&&(0,o.hasStringProperty)(e,"name")&&(0,s.hasBooleanProperty)(e,"enabled")&&(0,n.hasNumberProperty)(e,"ttl")}t.isFeatureFlagData=u,t.isFeatureFlagsData=function(e){return(0,r.isObject)(e)&&(0,i.hasArrayProperty)(e,"flags",u)&&(0,n.hasNumberProperty)(e,"lastUpdate")&&(0,n.hasNumberProperty)(e,"ttl")}},6426:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isUpdateInfo=void 0;const i=a(7744),s=a(2166),n=a(5643);t.isUpdateInfo=function(e){return(0,i.isObject)(e)&&(0,s.hasBooleanProperty)(e,"updateRequired")&&(0,n.hasStringProperty)(e,"latestVersion")}},6720:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isRemoteFeatureFlagsData=void 0;const i=a(5923),s=a(3735),n=a(7744),r=a(6366);t.isRemoteFeatureFlagsData=function(e){return(0,n.isObject)(e)&&(0,i.hasArrayProperty)(e,"flags",r.isFeatureFlagData)&&(0,s.hasNumberProperty)(e,"ttl")}},6744:(e,t)=>{var a;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.QuizView="quiz-view"}(a||(a={})),t.default=a},7174:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=a(2666),s=a(8348),n=a(3352),r=a(3118);class o extends n.ApiClient{constructor(e,t){super(e,r.defaultLogger.child("AccountApi")),this.authService=t}async getApiKeyHeader(){const e={},t=await this.authService.getAccessToken();return null!=t&&(e["X-Api-Key"]=t),e}async getUserData(){return await this.fetchJson("v2/account/user",{method:"GET",headers:await this.getApiKeyHeader(),typeGuard:i.isUserData})}async getAccountEdition(e){return await this.fetchJson("v2/account/edition",{method:"POST",headers:await this.getApiKeyHeader(),objectBody:e,typeGuard:s.isEditionSchema})}}t.default=o},7325:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.initMessagesFeature=void 0;const s=i(a(8656)),n=i(a(4024)),r=i(a(4993));t.initMessagesFeature=async function(e){const t=new s.default,a=new n.default(e.systemApi),i=new r.default(e.systemApi);await t.init(e.bus),await i.init(e.bus),await a.init(e.bus)}},7669:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isLocalCompletionRequest=void 0;const i=a(7744),s=a(3735),n=a(5643);t.isLocalCompletionRequest=function(e){return(0,i.isObject)(e)&&(0,n.hasStringProperty)(e,"host")&&(0,s.hasNumberProperty)(e,"quizId")}},8079:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isCorrectLoginSchema=t.isLoginSchema=void 0;const i=a(7744),s=a(8267),n=a(2166);function r(e){return(0,i.isObject)(e)&&(0,s.hasStringOrNullProperty)(e,"access_token")&&(0,s.hasStringOrNullProperty)(e,"refresh_token")&&(0,n.hasBooleanProperty)(e,"reset")}t.isLoginSchema=r,t.isCorrectLoginSchema=function(e){return r(e)&&null!=e.refresh_token&&null!=e.access_token}},8267:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.hasStringOrNullProperty=void 0;const i=a(8642);t.hasStringOrNullProperty=function(e,t){return t in e&&(0,i.isStringOrNull)(e[t])}},8277:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isQrDataSchema=void 0;const i=a(7744),s=a(5643);t.isQrDataSchema=function(e){return(0,i.isObject)(e)&&(0,s.hasStringProperty)(e,"qr_data")}},8348:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isEditionSchema=void 0;const i=a(7744),s=a(2166),n=a(5643);t.isEditionSchema=function(e){return(0,i.isObject)(e)&&(0,s.hasBooleanProperty)(e,"plus_edition")&&(0,n.hasStringProperty)(e,"restricted")}},8642:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isStringOrNull=void 0,t.isStringOrNull=function(e){return"string"==typeof e||null==e}},8656:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(859)),n=i(a(6815)),r=a(3109),o=a(3118),u=a(2946),l=o.defaultLogger.child("ChangelogMessage"),c={install:{title:n.default.i18n.getMessage("installTitle"),content:n.default.i18n.getMessage("installContent"),construct:!0,keyboard:!1,backdrop:"static",headerClose:!1,buttons:[{text:n.default.i18n.getMessage("gotIt"),value:!1,attr:{class:"btn btn-primary","data-dismiss":"modal"}}]},changelog:{title:n.default.i18n.getMessage("changelogTitle"),content:n.default.i18n.getMessage("changelogContent"),construct:!0,keyboard:!1,backdrop:"static",headerClose:!1,buttons:[{text:n.default.i18n.getMessage("gotIt"),value:!1,attr:{class:"btn btn-primary","data-dismiss":"modal"}}]}};t.default=class{async init(e){e.bind(s.default.GetInstallationMessage,r.isNever,e=>this.getInstallationMessage()),l.info("Initialized")}async getInstallationMessage(){const e=await n.default.storage.local.get({installationMessage:"none"});return l.info("Got installation message",(0,u.extras)({message:e.installationMessage})),"none"===e.installationMessage?(await n.default.storage.local.set({installationMessage:"2.11.0"}),c.install):null}}},8674:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.LocalStorage=void 0;const s=i(a(6815)),n=a(3118),r=a(2946),o=n.defaultLogger.child("LocalStorage");class u{constructor(e,t){this.typeGuard=e,this.key=t}async get(){const e={};e[this.key]=u.UNDEFINED_VALUE;const t=await s.default.storage.local.get(e);return t[this.key]===u.UNDEFINED_VALUE?null:this.typeGuard(t[this.key])?t[this.key]:(o.error(`Could not get data from local storage for the key '${this.key}': validation failed`,(0,r.extras)({storageContent:t})),this.clear(),null)}async set(e){if(this.typeGuard(e)){const t={};t[this.key]=e,await s.default.storage.local.set(t)}else o.error(`Could not save data to local storage for the key '${this.key}': validation failed`,(0,r.extras)({data:e}))}async clear(){await s.default.storage.local.remove(this.key)}}t.LocalStorage=u,u.UNDEFINED_VALUE="9o15gfQAJbg-undefined-5a5RemYzWXw7I0"},8814:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.initBackgroundDiagnostic=void 0;const i=a(5794),s=a(4810),n=a(6564),r=a(9735),o=a(6336),u=a(2206);t.initBackgroundDiagnostic=async function(e){[new i.ConnectivityDiagnosticCollector(e.systemApi),new s.AccountDiagnosticCollector(e.accountService),new n.SettingsDiagnosticCollector(e.bus),new r.MagicButtonStateDiagnosticCollector,new o.ActiveTabDiagnosticCollector,new u.LogsDiagnosticCollector].forEach(t=>t.init(e.bus))}},8894:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UserStorage=void 0;const i=a(2666),s=a(9789);class n extends s.InMemoryStorage{constructor(){super(i.isUserData)}}t.UserStorage=n},8910:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(5045)),n=a(4878),r=a(7325),o=a(11),u=a(9652),l=a(5560),c=a(1081),d=a(9476),g=a(4152),h=a(8814),f=a(2418),p=a(4988),y=i(a(859));(0,p.initPrivacyPolicyFeature)(),async function(){const e={...c.BusModule,...d.ServiceModule};await(0,o.initCommonSettings)(e),(await e.bus.publishLocally(y.default.GetSettings)).allowTechnicalDataCollection&&s.default.init();const t={...await(0,u.initCommonApi)(e),...await(0,n.initAccountFeature)(e)},a={...e,...t};await(0,h.initBackgroundDiagnostic)({...e,...t}),await(0,r.initMessagesFeature)(a),await(0,g.initFeatureFlags)(a),await(0,l.initQuizFeature)(a),(0,f.initRemoteLogsListener)(c.BusModule)}()},8924:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(859)),n=i(a(6815)),r=a(3109),o=a(5263),u=a(3118),l=a(2946),c=u.defaultLogger.child("SettingService"),d={widgetToggleHotkey:"esc",widgetToggleDoubleClick:!0,hideWidgetByDefault:!1,hideNotifications:!1,allowTechnicalDataCollection:!1,privacyPolicyAcceptedByUser:!1};t.default=class{async init(e){e.bind(s.default.GetSettings,r.isNever,e=>this.getSettings()),e.bind(s.default.SetSettings,o.isSettings,e=>{this.setSettings(e)}),this.bus=e,c.info("Initialized")}async setSettings(e){await n.default.storage.local.set({settings:e}),this.bus.publishToActiveTab(s.default.SettingsUpdated,e),this.bus.publishLocally(s.default.SettingsUpdated,e),c.info("Settings updated",(0,l.extras)({settings:e}))}async getSettings(){const e=await n.default.storage.local.get({settings:d});return(0,o.isSettings)(e.settings)?e.settings:(c.warn("LocalStorage contains invalid settings object",(0,l.extras)({settings:e})),{...e.settings,...d})}}},9476:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ServiceModule=void 0,t.ServiceModule={serviceUrl:"https://syncshare.ru/api/",accountsUrl:"https://syncshare.ru/api/"}},9652:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.initCommonApi=void 0;const i=a(4453);t.initCommonApi=async function(e){return{systemApi:new i.SystemApi(e.serviceUrl)}}},9789:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.InMemoryStorage=void 0;const i=a(3118),s=a(2946),n=i.defaultLogger.child("InMemoryStorage");t.InMemoryStorage=class{constructor(e){this.typeGuard=e,this.inMemoryCache=void 0}async clear(){this.inMemoryCache=void 0}async get(){return void 0===this.inMemoryCache?null:this.typeGuard(this.inMemoryCache)?this.inMemoryCache:(n.error("Could not get data from memory storage: validation failed",(0,s.extras)({data:this.inMemoryCache})),null)}async set(e){this.typeGuard(e)?this.inMemoryCache=e:n.error("Could not save data to memory storage: validation failed",(0,s.extras)({data:e}))}}}},i={};function s(e){var t=i[e];if(void 0!==t)return t.exports;var n=i[e]={id:e,loaded:!1,exports:{}};return a[e].call(n.exports,n,n.exports,s),n.loaded=!0,n.exports}s.m=a,s.x=()=>{var e=s.O(void 0,[223],()=>s(8910));return s.O(e)},e=[],s.O=(t,a,i,n)=>{if(!a){var r=1/0;for(c=0;c<e.length;c++){for(var[a,i,n]=e[c],o=!0,u=0;u<a.length;u++)(!1&n||r>=n)&&Object.keys(s.O).every(e=>s.O[e](a[u]))?a.splice(u--,1):(o=!1,n<r&&(r=n));if(o){e.splice(c--,1);var l=i();void 0!==l&&(t=l)}}return t}n=n||0;for(var c=e.length;c>0&&e[c-1][2]>n;c--)e[c]=e[c-1];e[c]=[a,i,n]},s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var a in t)s.o(t,a)&&!s.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},s.f={},s.e=e=>Promise.all(Object.keys(s.f).reduce((t,a)=>(s.f[a](e,t),t),[])),s.u=e=>"js/commons.js",s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),s.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.j=471,(()=>{var e,t=!!(()=>{try{return browser.runtime.getURL("/")}catch(e){}})(),a=!!(()=>{try{return chrome.runtime.getURL("/")}catch(e){}})(),i=t?browser:a?chrome:{get runtime(){throw new Error("No chrome or browser runtime found")}};s.g.importScripts&&(e=s.g.location+"");var n=s.g.document;if(!e&&n&&n.currentScript&&(e=n.currentScript.src),!e){if(!a&&!t)throw new Error("Automatic publicPath is not supported in this browser");e=i.runtime.getURL("/")}e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),s.p=e+"../"})(),(()=>{var e={471:1};s.f.i=(t,a)=>{e[t]||importScripts(s.p+s.u(t))};var t=self.webpackChunksyncshare_extension=self.webpackChunksyncshare_extension||[],a=t.push.bind(t);t.push=t=>{var[i,n,r]=t;for(var o in n)s.o(n,o)&&(s.m[o]=n[o]);for(r&&r(s);i.length;)e[i.pop()]=1;a(t)}})(),(()=>{const e=!!(()=>{try{if("function"==typeof browser.runtime.getURL)return!0}catch(e){}})(),t=e?browser:chrome;t.runtime.onMessage.addListener((a,i,s)=>{if(!(a&&"WTW_INJECT"===a.type&&i&&i.tab&&null!=i.tab.id))return;let n=a.file;try{n=new URL(n).pathname}catch{}if(n){if(t.scripting)t.scripting.executeScript({target:{tabId:i.tab.id,frameIds:[i.frameId]},files:[n]}).then(s);else{const a={frameId:i.frameId,file:n,matchAboutBlank:!0};e?t.tabs.executeScript(i.tab.id,a).then(s):t.tabs.executeScript(i.tab.id,a,s)}return!0}})})(),s.f.i(223),t=s.x,s.x=()=>s.e(223).then(t),s.x()})();