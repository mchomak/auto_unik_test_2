(()=>{"use strict";var e,t={67:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Question=t.QTextWrapper=t.getStateFromClassList=void 0;const s=n(9766),o=i(n(6815)),r=n(2229),a=i(n(1877)),l=n(1420),c=n(7744),u=n(254),d=n(4963),h=n(3118),p=n(1080),g=h.defaultLogger.child("Question");t.getStateFromClassList=function(e){const t=e.classList;return t.contains("incorrect")?p.State.Incorrect:t.contains("prtiallycorrect")?p.State.PartiallyCorrect:t.contains("correct")?p.State.Correct:p.State.Unknown},t.QTextWrapper=class{constructor(e){this.formulationImages=[];const t=(0,u.checkNotNull)(e.querySelector(".qtext"),"Missing .qtext");this.formulation=t.innerHTML,t.querySelectorAll("img").forEach(e=>{const t=(0,r.fromImageElementLazy)(e);this.formulationImages.push(t)});const n=t.cloneNode(!0);n.querySelectorAll(".accesshide").forEach(e=>e.parentElement?.removeChild(e)),this.identity=(0,d.identity)(n.innerText)}getFormulation(){return{html:this.formulation,images:this.formulationImages}}getIdentity(){return this.identity}},t.Question=class{constructor(e){this.id=null,this.grade=[];const t=e.classList;if(t.length<4)throw Error("Invalid question container: class list doesnt contain required data");const n=e.querySelector("input.questionflagpostdata");if(null!=n){const e=(0,u.checkIfInstance)(n,HTMLInputElement,"Question doesn't have details block");this.id=this.extractQuestionId(e)}else g.warn("Question doesn't have details block. Fallback to identity.");this.__type=t[1],this.behavior=t[2],this.state=t[3];const i=(0,u.checkNotNull)(e.querySelector("div.info"),"Could not locate .info block").querySelector("div.grade");if(i)for(const e of i.innerText.matchAll(/[0-9]\d*([.,]\d+)?/g))this.grade.push(parseFloat(e[0]));this.container=e}extractQuestionId(e){const t=e.getAttribute("data-original-value");if(t){g.debug("Detected modified format with data-original-value");const e=new URL("a://a/a?"+t).searchParams.get("qid");if(e)return parseInt(e)}const n=e.value,i=new URL("a://a/a?"+n),s=i.searchParams.get("actualQid");if(s)return g.debug("Detected modified format with actualQid"),parseInt(s);const o=i.searchParams.get("qid");return o?parseInt(o):(g.warn("Failed to extract question ID from questionflagpostdata element"),null)}handleSolution(e,t){function n(e){const t={backColor:"rgba(228,225,237,0.44)",frontColor:"#5D616C"};switch(e){case p.State.Incorrect:t.backColor="rgba(255,221,227,0.87)",t.frontColor="#F93A5B";break;case p.State.PartiallyCorrect:t.backColor="rgba(254,245,212,0.67)",t.frontColor="#FA9A0F";break;case p.State.Correct:t.backColor="rgba(225,238,227,0.73)",t.frontColor="#27993A"}return t}const i=[],r=e.suggestions,u=e.submissions,d=e.suggestionsLock,h=this.createWidgetAnchor(e.anchor);if(!h)return void g.warn("Could not create widget anchor");if((0,c.isObject)(d)){const e=()=>window.open(d.actionUrl,"_blank")?.focus();i.push({label:o.default.i18n.getMessage("magicMenuSuggestions"),icon:{alignRight:!1},subMenu:[{label:d.message,icon:{svg:"lock",alignRight:!0}},{label:d.actionText,icon:{svg:"external-link",alignRight:!0},action:e}]})}if(r&&r.length>0){const e={label:o.default.i18n.getMessage("magicMenuSuggestions"),icon:{svg:"bolt",alignRight:!1},subMenu:[]};r.forEach(t=>{this.autofillSupported?e.subMenu?.push({label:t.label,icon:{alignRight:!0,text:100*t.confidence+"%",...n(t.correctness)},action:()=>h.onApply(t.data)}):e.subMenu?.push({label:t.label,icon:{alignRight:!0,text:100*t.confidence+"%",...n(t.correctness)},subMenu:[{label:t.label,icon:{svg:"copy",alignRight:!0},action:()=>h.onApply(t.data)}]})}),i.push(e)}if(u&&u?.length>0){const e={label:o.default.i18n.getMessage("magicMenuSubmissions"),icon:{svg:"chart-bar",alignRight:!1},subMenu:[]};u.forEach(t=>{this.autofillSupported?e.subMenu?.push({label:t.label,icon:{alignRight:!0,text:t.count.toString(),...n(t.correctness)},action:()=>h.onApply(t.data)}):e.subMenu?.push({label:t.label,icon:{alignRight:!0,text:t.count.toString(),...n(t.correctness)},subMenu:[{label:t.label,icon:{svg:"copy",alignRight:!0},action:()=>h.onApply(t.data)}]})}),i.push(e)}const f=(0,l.wrapWithShadowDom)(h.container),m=new a.default;new s.ContextMenu(i).attach(m,f.hostElement);const w=document.createElement("slot");"before"===h.appendPosition?(f.shadowRoot.appendChild(m.element),f.shadowRoot.appendChild(w)):(f.shadowRoot.appendChild(w),f.shadowRoot.appendChild(m.element)),t.register(m)}handleOrphans(e,t){const n=[];n.push({label:t.message,icon:{svg:t.iconSvg,alignRight:!1}},{label:o.default.i18n.getMessage("documentation"),icon:{svg:"external-link",alignRight:!1},action:()=>window.open("https://syncshare.naloaty.me/no-magic-help","_blank")?.focus()});const i=this.getOrphanContainers();for(const o of i){const i=(0,l.wrapWithShadowDom)(o.container),r=new t.button;new s.ContextMenu(n).attach(r,i.hostElement);const a=document.createElement("slot");"before"===o.appendPosition?(i.shadowRoot.appendChild(r.element),i.shadowRoot.appendChild(a)):(i.shadowRoot.appendChild(a),i.shadowRoot.appendChild(r.element)),e.register(r)}}serializeToJSON(){return{id:this.id,__type:this.__type,behavior:this.behavior,state:this.state,grade:this.grade,identity:this.identity}}}},436:function(e,t,n){var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);var s=Object.getOwnPropertyDescriptor(t,n);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,s)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&i(t,e,n);return s(t,e),t};Object.defineProperty(t,"__esModule",{value:!0});const r=o(n(8506)),a=o(n(1692)),l=o(n(4369)),c=o(n(7759)),u=o(n(1292)),d=o(n(8911)),h=n(7979),p=n(3118),g=n(2946),f=p.defaultLogger.child("QuestionParser");t.default=class{parse(e){try{switch(f.debug(`Parsing '${e.classList[1]}'`),e.classList[1]){case h.QuestionType.Match:return f.debug("Using Match parser"),new r.Parser(e);case h.QuestionType.Multianswer:case h.QuestionType.GapFill:case h.QuestionType.GapSelect:return f.debug("Using Multianswer parser"),new a.Parser(e);case h.QuestionType.Multichoice:case h.QuestionType.MultichoiceSet:case h.QuestionType.TrueFalse:return f.debug("Using Multichoice parser"),new l.Parser(e);case h.QuestionType.Shortanswer:case h.QuestionType.Numerical:return f.debug("Using Shortanswer parser"),new c.Parser(e);case h.QuestionType.Coderunner:return f.debug("Using Coderunner parser"),new u.Parser(e);default:return f.warn("Unknown question type",(0,g.extras)({cssClass:e.classList[1]})),new d.Parser(e)}}catch(t){f.error("Could not parse question",(0,g.extras)({error:t,html:e.outerHTML}))}return null}}},812:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(n(1877)),o=i(n(1451));class r extends s.default{createElement(){const e=new o.default("clock-o");return e.element.style.cursor="pointer",e.element}}t.default=r},1292:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Parser=void 0;const i=n(67),s=n(254),o=n(2229),r=n(4963);class a{constructor(e){const t=e.querySelector("textarea.coderunner-answer");this.control=(0,s.checkNotNull)(t,"Missing textarea element"),this.container=e}getUserInput(){return this.control.value}createWidgetAnchor(){const e=(0,s.checkNotNull)(this.container.querySelector("div.prompt"),"Missing place for magic wand"),t=document.createElement("span");return e.appendChild(t),{container:t,onApply:e=>{navigator.clipboard.writeText(e)},appendPosition:"after"}}}class l extends i.Question{constructor(e){super(e),this.formulationImages=[],this._wanded=!1;const t=(0,s.checkNotNull)(this.container.querySelector("div.formulation"),"Missing .formulation");t.querySelectorAll("img").forEach(e=>{const t=(0,o.fromImageElementLazy)(e);this.formulationImages.push(t)}),this.formulation=t.innerHTML,this.wrapper=new a(this.container);const n=t.cloneNode(!0);n.querySelectorAll(".accesshide").forEach(e=>e.parentElement?.removeChild(e)),this.identityInternal=(0,r.identity)(n.innerText)}createWidgetAnchor(e){return this._wanded=!0,this.wrapper.createWidgetAnchor()}getOrphanContainers(){if(!this._wanded){const e=this.createWidgetAnchor(null);if(e)return[{container:e.container,appendPosition:"after"}]}return[]}get identity(){return this.identityInternal.toString()}get autofillSupported(){return!1}serializeToJSON(){return{...super.serializeToJSON(),formulation:{html:this.formulation,images:this.formulationImages},userInput:this.wrapper.getUserInput(),feedback:this.getFeedback()}}getFeedback(){const e=this.container.querySelector("div.outcome");return e instanceof HTMLDivElement?e.innerHTML:null}}t.Parser=l},1318:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 512">\x3c!--!Font Awesome Free v7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--\x3e<path d="M247.1 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L179.2 256 41.9 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg>'},1451:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(n(4355)),o=n(3118),r=n(2946),a=o.defaultLogger.child("Icon");t.default=class{constructor(e,t,n,i){this._element=document.createElement("span"),this._element.classList.add("icon"),t&&this._element.classList.add(t),this._element.style.display="inline-flex",this._element.style.alignItems="center",this._element.style.justifyContent="center",this._element.style.width=n??"1em",this._element.style.height=i??"1em",this._element.style.fill="currentColor",this._element.setAttribute("aria-hidden","true");try{let t;e in s.default?t=s.default[e]:(t=s.default["triangle-exclamation"],a.info(`Icon "${e}" not found, using default triangle-exclamation`));const n=(new DOMParser).parseFromString(t,"image/svg+xml").documentElement;if(!n||"svg"!==n.nodeName.toLowerCase())throw new Error(`Invalid SVG for "${e}"`);const i=document.importNode(n,!0);i.removeAttribute("width"),i.removeAttribute("height"),i.setAttribute("focusable","false"),i.style.width="100%",i.style.height="100%",this._element.appendChild(i)}catch(e){a.error("Error creating icon element",(0,r.extras)({error:e}))}}get element(){return this._element}}},1641:function(e,t,n){var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);var s=Object.getOwnPropertyDescriptor(t,n);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,s)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&i(t,e,n);return s(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.fuzzyAnchor=void 0;const r=o(n(2787));t.fuzzyAnchor=function(e,t){if(0===t.length)return-1;let n=!1,i=-1,s=1/0;for(let o=0;o<t.length;o++){const a=t[o];let l=1/0;e:for(const t of e)for(const e of a){const n=r.distance(t,e);if(!(n>Math.max(e.length,t.length)/2)&&(n<l&&(l=n),0===n))break e}if(0===l)return o;l<s&&l!==1/0?(i=o,s=l,n=!1):l===s&&l!==1/0&&(n=!0)}return n||-1===i?-1:i}},1661:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512">\x3c!--!Font Awesome Pro v7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2025 Fonticons, Inc.--\x3e<path d="M509.4 98.6c7.6-7.6 20.3-5.7 24.1 4.3 6.8 17.7 10.5 37 10.5 57.1 0 88.4-71.6 160-160 160-17.5 0-34.4-2.8-50.2-8L146.9 498.9c-28.1 28.1-73.7 28.1-101.8 0s-28.1-73.7 0-101.8L232 210.2c-5.2-15.8-8-32.6-8-50.2 0-88.4 71.6-160 160-160 20.1 0 39.4 3.7 57.1 10.5 10 3.8 11.8 16.5 4.3 24.1l-88.7 88.7c-3 3-4.7 7.1-4.7 11.3l0 41.4c0 8.8 7.2 16 16 16l41.4 0c4.2 0 8.3-1.7 11.3-4.7l88.7-88.7z"/></svg>'},1692:function(e,t,n){var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);var s=Object.getOwnPropertyDescriptor(t,n);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,s)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&i(t,e,n);return s(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Parser=void 0;const r=n(67),a=o(n(4369)),l=o(n(7759)),c=o(n(8506)),u=n(2229),d=n(254),h=n(4963);var p;function g(e){const t=e.match(/sub(\d+)/),n=e.match(/p(\d+)/),i=t??n,s=(0,d.checkNotNull)(i,"Could not parse subquestion's index");return parseInt(s[1])}!function(e){e.Shortanswer="sa",e.MultichoiceSingle="mc_single",e.MultichoiceSeveral="mc_several",e.Combobox="cb"}(p||(p={}));class f extends a.ContainerWrapper{constructor(e){super(e),this.index=g(this.answerOptions[0].getControl().name),this.__type=this.multipleAnswersAllowed?p.MultichoiceSeveral:p.MultichoiceSingle}serializeToJSON(){return{index:this.index,__type:this.__type,options:this.getOptions(),feedback:this.getFeedback()}}createWidgetAnchor(e){return super.createWidgetAnchor(e)}getFeedback(){const e=this.container.nextElementSibling;return null===e||-1===e.className.indexOf("outcome")?null:e.outerHTML}}class m extends l.ControlWrapper{constructor(e){super(e),this.__type=p.Shortanswer,this.index=g(e.name)}serializeToJSON(){return{index:this.index,__type:this.__type,userInput:this.getUserInput(),feedback:this.getFeedback()}}createWidgetAnchor(){return super.createWidgetAnchor()}getIdentity(){return 0}getFeedback(){const e=this.control.parentElement;if(null===e)return null;const t=e.querySelector("span.feedbackspan");return null===t?null:t.outerHTML}}class w extends c.ControlWrapper{constructor(e){super(e),this.__type=p.Combobox,this._wanded=!1,this.index=g(e.name)}serializeToJSON(){return{index:this.index,__type:this.__type,options:this.getOptions(),userInput:this.getUserInput(),feedback:this.getFeedback()}}getIdentity(){return(0,h.compoundIdentity)(...this.getOptions().map(e=>(0,h.identity)(e)))}createWidgetAnchor(){return this._wanded=!0,{onApply:e=>super.setOption(e),container:this.parent,appendPosition:"after"}}getOrphanContainers(){return this._wanded?[]:[{container:this.parent,appendPosition:"after"}]}getFeedback(){const e=this.control.parentElement;if(null===e)return null;const t=e.querySelector("span.feedbackspan");return null===t?null:t.outerHTML}}class b extends r.Question{constructor(e){super(e),this.formulationImages=[],this.subquestions=new Map;const t=(0,d.checkNotNull)(this.container.querySelector("div.formulation"),"Missing .formulation");t.querySelectorAll("img").forEach(e=>{const t=(0,u.fromImageElementLazy)(e);this.formulationImages.push(t)}),this.formulation=t.innerHTML,this.container.querySelectorAll("div.answer, table.answer, fieldset.answer").forEach(e=>{const t=new f(e);this.subquestions.set(t.index,t)}),this.container.querySelectorAll("select.select").forEach(e=>{const t=new w(e);this.subquestions.set(t.index,t)}),this.container.querySelectorAll('input[type="text"]').forEach(e=>{const t=new m(e);this.subquestions.set(t.index,t)});const n=t.cloneNode(!0);n.querySelectorAll("div.answer, table.answer, fieldset.answer").forEach(e=>e.parentElement?.removeChild(e)),n.querySelectorAll("select.select").forEach(e=>e.parentElement?.removeChild(e)),n.querySelectorAll('input[type="text"]').forEach(e=>e.parentElement?.removeChild(e)),n.querySelectorAll(".subquestion").forEach(e=>e.parentElement?.removeChild(e)),n.querySelectorAll(".feedbackspan").forEach(e=>e.parentElement?.removeChild(e)),n.querySelectorAll(".specificfeedback").forEach(e=>e.parentElement?.removeChild(e)),n.querySelectorAll(".outcome").forEach(e=>e.parentElement?.removeChild(e)),n.querySelectorAll(".accesshide").forEach(e=>e.parentElement?.removeChild(e)),this.identityInternal=(0,h.identity)(n.innerText);for(const e of this.subquestions.values())this.identityInternal=(0,h.compoundIdentity)(this.identityInternal,e.getIdentity())}serializeToJSON(){const e=[];for(const t of this.subquestions.values())e.push(t.serializeToJSON());return{...super.serializeToJSON(),formulation:{html:this.formulation,images:this.formulationImages},subquestions:e,feedback:this.getFeedback()}}createWidgetAnchor(e){const t=this.subquestions.get(e.index);return void 0===t||t.__type!==e.__type?null:t.createWidgetAnchor(e.anchor)}getOrphanContainers(){const e=[];for(const t of this.subquestions.values())e.push(...t.getOrphanContainers());return e}get identity(){return this.identityInternal.toString()}get autofillSupported(){return!0}getFeedback(){const e=this.container.querySelector("div.feedback");return e instanceof HTMLDivElement?e.innerHTML:null}}t.Parser=b},1877:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(n(4508)),o=i(n(1451));class r extends s.default{createElement(){const e=new o.default("magic");return e.element.style.cursor="pointer",e.element}}t.default=r},2229:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getSrcFilename=t.fromImageElementLazy=void 0;const i=n(4025);t.fromImageElementLazy=function(e){const t={src:"",alt:e.alt,data:""};return e.src.startsWith("data:")?t.src=(0,i.hashString)(e.src).toString():t.src=e.src,t},t.getSrcFilename=function(e){const t=e.src.lastIndexOf("/");return-1!==t?e.src.slice(t+1):e.src}},2894:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(n(1877)),o=i(n(1451));class r extends s.default{createElement(){const e=new o.default("wrench");return e.element.style.cursor="pointer",e.element}}t.default=r},4025:(e,t)=>{function n(e){return e.replace(/^ +| +$|\\n|\n/g,"")}function i(e){let t,n,i=0;if(0===e.length)return i;for(t=0;t<e.length;t++)n=e.charCodeAt(t),i=(i<<5)-i+n,i|=0;return i}Object.defineProperty(t,"__esModule",{value:!0}),t.hashQuestionImage=t.hashString=t.cleanString=void 0,t.cleanString=n,t.hashString=i,t.hashQuestionImage=function(e){const t=e.src.lastIndexOf("/"),s={fn:n(-1!==t?e.src.slice(t+1):e.src),alt:e.alt};return i(JSON.stringify(s)).toString()}},4355:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(n(9672)),o=i(n(1661)),r=i(n(1318)),a=i(n(7095)),l=i(n(4851)),c=i(n(6206)),u=i(n(7809)),d=i(n(9808)),h=i(n(7699)),p=i(n(6814)),g={magic:a.default,"clock-o":s.default,wrench:o.default,"angle-right":r.default,bolt:l.default,"chart-bar":c.default,copy:u.default,"external-link":d.default,lock:h.default,"triangle-exclamation":p.default};t.default=g},4369:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Parser=t.ContainerWrapper=void 0;const i=n(67),s=n(4963),o=n(2229),r=n(1641),a=n(254),l=n(3118).defaultLogger.child("Multichoice");class c{constructor(e,t){this.images=[],this.anchor=[],this._wanded=!1,this.control=e,this.container=t,this.parent=(0,a.checkNotNull)(e.parentElement,"AnswerOption: Missing control's parent element");const n=(0,a.checkNotNull)(e.labels,"AnswerOption: Control is hidden");if(0===n.length){const t=(0,a.checkNotNull)(e.getAttribute("aria-labelledby"),"AnswerOption: Control doesn't have aria-labelledby"),n=t.replace(":","\\:");this.label=(0,a.checkNotNull)(this.container.querySelector("#"+n),`AnswerOption: Label '${t}' not found`)}else this.label=n[0];let i;const r=this.label.querySelector(".answernumber");if(null!==r){const e=(0,a.checkNotNull)(this.label.lastChild,"AnswerOption: Label doesn't have children");if(r===e)throw Error("AnswerOption: Label contains only number");e instanceof HTMLElement?(i=(0,s.strip)(e.innerText),this.textHtml=e.innerHTML):(i=(0,s.strip)(e.textContent??""),this.textHtml=i)}else i=(0,s.strip)(this.label.innerText),this.textHtml=this.label.innerHTML;""!==i&&(this.anchor.push(i),this.identity=(0,s.identity)(i)),this.label.querySelectorAll("img").forEach(e=>{const t=(0,o.fromImageElementLazy)(e);this.images.push(t),this.identity=(0,s.compoundIdentity)(this.identity,(0,s.identity)((0,o.getSrcFilename)(t)));const n=(0,s.extractFilenameFromUrl)(t.src);n&&this.anchor.push(n)})}getControl(){return this.control}serializeToJson(){return{html:this.textHtml,images:this.images,userInput:{checked:this.control.checked,state:(0,i.getStateFromClassList)(this.parent)}}}createWidgetContainer(){return this._wanded=!0,this.parent}setChecked(e){this.control.checked=e}getAnchor(){return this.anchor}getIdentity(){return this.identity}get wanded(){return this._wanded}}class u{constructor(e){this.answerOptions=[],this._wanded=!1,this.container=e;const t=e.querySelectorAll('input[type="radio"]'),n=e.querySelectorAll('input[type="checkbox"]');if(t.length>0)this.multipleAnswersAllowed=!1,t.forEach(t=>{t instanceof HTMLInputElement&&this.answerOptions.push(new c(t,e))});else{if(!(n.length>0))throw Error("Could not parse multichoice question: input elements are not found");this.multipleAnswersAllowed=!0,n.forEach(t=>{t instanceof HTMLInputElement&&this.answerOptions.push(new c(t,e))})}}getOptions(){return this.answerOptions.map(e=>e.serializeToJson())}getIdentity(){return(0,s.compoundIdentity)(...this.answerOptions.map(e=>e.getIdentity()))}getOrphanContainers(){const e=[];if(this.multipleAnswersAllowed)for(const t of this.answerOptions)t.wanded||e.push({container:t.createWidgetContainer(),appendPosition:"before"});else this._wanded||e.push({container:this.container,appendPosition:"after"});return e}createWidgetAnchor(e){if(this.multipleAnswersAllowed){const t=(0,r.fuzzyAnchor)(e,this.answerOptions.map(e=>e.getAnchor()));if(-1===t)return null;const n=this.answerOptions[t];return{onApply:e=>{const t=e.checked;void 0!==t?n.setChecked(t):l.warn("(checkbox) Could not autofill solution: missing checked flag")},container:n.createWidgetContainer(),appendPosition:"after"}}{const e=e=>{const t=e.anchor;if(void 0===t)return void l.warn("(radio): Could not autofill solution: missing anchor");const n=(0,r.fuzzyAnchor)(t,this.answerOptions.map(e=>e.getAnchor()));-1!==n&&this.answerOptions[n]?.setChecked(!0)};return this._wanded=!0,{onApply:e,container:this.container,appendPosition:"after"}}}}t.ContainerWrapper=u;class d extends i.Question{constructor(e){super(e);const t=(0,a.checkNotNull)(this.container.querySelector("div.answer"),"Missing .answer");this.wrapper=new u(t),this.formulation=new i.QTextWrapper(e)}serializeToJSON(){return{...super.serializeToJSON(),formulation:this.formulation.getFormulation(),options:this.wrapper.getOptions(),feedback:this.getFeedback(),single:!this.wrapper.multipleAnswersAllowed}}getOrphanContainers(){return this.wrapper.getOrphanContainers()}createWidgetAnchor(e){return this.wrapper.createWidgetAnchor(e)}get identity(){return(0,s.compoundIdentity)(this.formulation.getIdentity(),this.wrapper.getIdentity()).toString()}get autofillSupported(){return!0}getFeedback(){const e=this.container.querySelector("div.feedback");return e instanceof HTMLDivElement?e.innerHTML:null}}t.Parser=d},4508:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(){this._visible=!0,this._element=this.createElement(),this._element.style.setProperty("display","inline-block","important")}get visible(){return this._visible}get element(){return this._element}hide(){this.element.style.setProperty("visibility","hidden","important"),this._visible=!1}show(){this.element.style.setProperty("visibility","visible","important"),this._visible=!0}toggleVisibility(){this._visible?this.hide():this.show()}}},4851:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">\x3c!--!Font Awesome Free v7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--\x3e<path d="M338.8-9.9c11.9 8.6 16.3 24.2 10.9 37.8L271.3 224 416 224c13.5 0 25.5 8.4 30.1 21.1s.7 26.9-9.6 35.5l-288 240c-11.3 9.4-27.4 9.9-39.3 1.3s-16.3-24.2-10.9-37.8L176.7 288 32 288c-13.5 0-25.5-8.4-30.1-21.1s-.7-26.9 9.6-35.5l288-240c11.3-9.4 27.4-9.9 39.3-1.3z"/></svg>'},5041:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MagicButtonRegistry=void 0;const s=i(n(859)),o=i(n(3259)),r=i(n(6815)),a=n(5263),l=n(3118),c=n(2946),u=n(3729),d=l.defaultLogger.child("MagicButtonRegistry");t.MagicButtonRegistry=class{constructor(){this.instances=new Set,this.doubleClickListener=()=>this.toggleMagicButtons()}async init(e){const t=await(0,u.getSettings)(e,d),{magicButtonsState:n}=await r.default.storage.local.get({magicButtonsState:{visibilityOverridden:!1,buttonsVisible:!0}});this.buttonsVisible=n.buttonsVisible,this.visibilityOverridden=n.visibilityOverridden,t&&this.applySettings(t),e.listen(s.default.SettingsUpdated,a.isSettings,e=>{this.applySettings(e)}),d.info("Initialized")}applySettings(e){this.setupButtonsVisibility(e.hideWidgetByDefault),this.setupHotkey(e.widgetToggleHotkey),this.setupDoubleClick(e.widgetToggleDoubleClick),d.info("Settings applied",(0,c.extras)({settings:e}))}setupButtonsVisibility(e){if(!this.visibilityOverridden){this.buttonsVisible=!e;for(const e of this.instances)this.buttonsVisible?e.show():e.hide();d.info(`Magic buttons visibility changed to ${this.buttonsVisible}`)}}setupHotkey(e){if(this.toggleHotkey){if(this.toggleHotkey===e)return;o.default.unbind(this.toggleHotkey)}(0,o.default)(e,{keyup:!0,keydown:!0},(e,t)=>{if(!e.repeat&&"keydown"===e.type)return this.toggleMagicButtons(),!1}),this.toggleHotkey=e}setupDoubleClick(e){!e&&this.toggleDoubleClick?window.removeEventListener("dblclick",this.doubleClickListener):e&&!this.toggleDoubleClick&&window.addEventListener("dblclick",this.doubleClickListener),this.toggleDoubleClick=e}toggleMagicButtons(){this.visibilityOverridden=!0;for(const e of this.instances)e.toggleVisibility();this.buttonsVisible=!this.buttonsVisible,d.info(`Magic buttons visibility changed to ${this.buttonsVisible}`),r.default.storage.local.set({magicButtonsState:{visibilityOverridden:this.visibilityOverridden,buttonsVisible:this.buttonsVisible}})}register(e){this.instances.add(e),this.buttonsVisible?e.show():e.hide()}}},6206:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">\x3c!--!Font Awesome Free v7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--\x3e<path d="M32 32c17.7 0 32 14.3 32 32l0 336c0 8.8 7.2 16 16 16l400 0c17.7 0 32 14.3 32 32s-14.3 32-32 32L80 480c-44.2 0-80-35.8-80-80L0 64C0 46.3 14.3 32 32 32zm96 64c0-17.7 14.3-32 32-32l192 0c17.7 0 32 14.3 32 32s-14.3 32-32 32l-192 0c-17.7 0-32-14.3-32-32zm32 80l128 0c17.7 0 32 14.3 32 32s-14.3 32-32 32l-128 0c-17.7 0-32-14.3-32-32s14.3-32 32-32zm0 112l256 0c17.7 0 32 14.3 32 32s-14.3 32-32 32l-256 0c-17.7 0-32-14.3-32-32s14.3-32 32-32z"/></svg>'},6329:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(n(980));class o extends s.default{async load(){const e=document.querySelector("a.endtestlink.aalink");if(e instanceof HTMLAnchorElement){const t=new URL(e.href),n=t.searchParams.get("cmid"),i=t.searchParams.get("attempt");n&&(this.data.quizId=parseInt(n)),i&&(this.data.attemptId=parseInt(i))}}}t.default=o},6814:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">\x3c!--!Font Awesome Free v7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--\x3e<path d="M256 0c14.7 0 28.2 8.1 35.2 21l216 400c6.7 12.4 6.4 27.4-.8 39.5S486.1 480 472 480L40 480c-14.1 0-27.2-7.4-34.4-19.5s-7.5-27.1-.8-39.5l216-400c7-12.9 20.5-21 35.2-21zm0 352a32 32 0 1 0 0 64 32 32 0 1 0 0-64zm0-192c-18.2 0-32.7 15.5-31.4 33.7l7.4 104c.9 12.5 11.4 22.3 23.9 22.3 12.6 0 23-9.7 23.9-22.3l7.4-104c1.3-18.2-13.1-33.7-31.4-33.7z"/></svg>'},7095:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512">\x3c!--!Font Awesome Free v7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--\x3e<path d="M263.4-27L278.2 9.8 315 24.6c3 1.2 5 4.2 5 7.4s-2 6.2-5 7.4L278.2 54.2 263.4 91c-1.2 3-4.2 5-7.4 5s-6.2-2-7.4-5L233.8 54.2 197 39.4c-3-1.2-5-4.2-5-7.4s2-6.2 5-7.4L233.8 9.8 248.6-27c1.2-3 4.2-5 7.4-5s6.2 2 7.4 5zM110.7 41.7l21.5 50.1 50.1 21.5c5.9 2.5 9.7 8.3 9.7 14.7s-3.8 12.2-9.7 14.7l-50.1 21.5-21.5 50.1c-2.5 5.9-8.3 9.7-14.7 9.7s-12.2-3.8-14.7-9.7L59.8 164.2 9.7 142.7C3.8 140.2 0 134.4 0 128s3.8-12.2 9.7-14.7L59.8 91.8 81.3 41.7C83.8 35.8 89.6 32 96 32s12.2 3.8 14.7 9.7zM464 304c6.4 0 12.2 3.8 14.7 9.7l21.5 50.1 50.1 21.5c5.9 2.5 9.7 8.3 9.7 14.7s-3.8 12.2-9.7 14.7l-50.1 21.5-21.5 50.1c-2.5 5.9-8.3 9.7-14.7 9.7s-12.2-3.8-14.7-9.7l-21.5-50.1-50.1-21.5c-5.9-2.5-9.7-8.3-9.7-14.7s3.8-12.2 9.7-14.7l50.1-21.5 21.5-50.1c2.5-5.9 8.3-9.7 14.7-9.7zM460 0c11 0 21.6 4.4 29.5 12.2l42.3 42.3C539.6 62.4 544 73 544 84s-4.4 21.6-12.2 29.5l-88.2 88.2-101.3-101.3 88.2-88.2C438.4 4.4 449 0 460 0zM44.2 398.5L308.4 134.3 409.7 235.6 145.5 499.8C137.6 507.6 127 512 116 512s-21.6-4.4-29.5-12.2L44.2 457.5C36.4 449.6 32 439 32 428s4.4-21.6 12.2-29.5z"/></svg>'},7699:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512">\x3c!--!Font Awesome Free v7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--\x3e<path d="M128 96l0 64 128 0 0-64c0-35.3-28.7-64-64-64s-64 28.7-64 64zM64 160l0-64C64 25.3 121.3-32 192-32S320 25.3 320 96l0 64c35.3 0 64 28.7 64 64l0 224c0 35.3-28.7 64-64 64L64 512c-35.3 0-64-28.7-64-64L0 224c0-35.3 28.7-64 64-64z"/></svg>'},7759:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Parser=t.ControlWrapper=void 0;const i=n(67),s=n(254);class o{constructor(e){this._wanded=!1,this.control=e}createWidgetAnchor(){const e=(0,s.checkNotNull)(this.control.parentElement,"Missing control's parent");return this._wanded=!0,{container:e,onApply:e=>this.control.value=e,appendPosition:"after"}}getOrphanContainers(){return this._wanded?[]:[{container:(0,s.checkNotNull)(this.control.parentElement,"Missing control's parent"),appendPosition:"after"}]}getUserInput(){return{value:this.control.value,state:(0,i.getStateFromClassList)(this.control)}}}t.ControlWrapper=o;class r extends i.Question{constructor(e){super(e);const t=(0,s.checkNotNull)(this.container.querySelector('input[type="text"]'),"Missing input field");this.wrapper=new o(t),this.formulation=new i.QTextWrapper(e)}createWidgetAnchor(){return this.wrapper.createWidgetAnchor()}getOrphanContainers(){return this.wrapper.getOrphanContainers()}get autofillSupported(){return!0}get identity(){return this.formulation.getIdentity().toString()}serializeToJSON(){return{...super.serializeToJSON(),formulation:this.formulation.getFormulation(),userInput:this.wrapper.getUserInput(),feedback:this.getFeedback()}}getFeedback(){const e=this.container.querySelector("div.feedback");return e instanceof HTMLDivElement?e.innerHTML:null}}t.Parser=r},7809:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">\x3c!--!Font Awesome Free v7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--\x3e<path d="M384 336l-192 0c-8.8 0-16-7.2-16-16l0-256c0-8.8 7.2-16 16-16l133.5 0c4.2 0 8.3 1.7 11.3 4.7l58.5 58.5c3 3 4.7 7.1 4.7 11.3L400 320c0 8.8-7.2 16-16 16zM192 384l192 0c35.3 0 64-28.7 64-64l0-197.5c0-17-6.7-33.3-18.7-45.3L370.7 18.7C358.7 6.7 342.5 0 325.5 0L192 0c-35.3 0-64 28.7-64 64l0 256c0 35.3 28.7 64 64 64zM64 128c-35.3 0-64 28.7-64 64L0 448c0 35.3 28.7 64 64 64l192 0c35.3 0 64-28.7 64-64l0-16-48 0 0 16c0 8.8-7.2 16-16 16L64 464c-8.8 0-16-7.2-16-16l0-256c0-8.8 7.2-16 16-16l16 0 0-48-16 0z"/></svg>'},7979:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.QuestionType=void 0,(n=t.QuestionType||(t.QuestionType={})).Match="match",n.Multichoice="multichoice",n.MultichoiceSet="multichoiceset",n.Shortanswer="shortanswer",n.Numerical="numerical",n.Multianswer="multianswer",n.GapSelect="gapselect",n.Coderunner="coderunner",n.GapFill="gapfill",n.TrueFalse="truefalse"},7996:function(e,t,n){var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);var s=Object.getOwnPropertyDescriptor(t,n);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,s)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&i(t,e,n);return s(t,e),t},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=r(n(436)),l=r(n(1857)),c=r(n(859)),u=n(183),d=r(n(7011)),h=r(n(6606)),p=r(n(4945)),g=r(n(197)),f=r(n(6248)),m=r(n(6329)),w=r(n(840)),b=n(5041),y=r(n(6077)),v=r(n(6815)),_=o(n(2176)),M=r(n(3897)),S=n(2938),x=r(n(5045)),C=n(4139),O=n(3793),L=r(n(812)),k=r(n(2894)),A=n(8911),q=n(8004),I=n(1931),E=n(6148),P=n(2592),T=n(3118),z=n(2946),N=n(3729),F=n(1080),j=T.defaultLogger.child("QuizPage");class D{constructor(e){this.bus=e,this.questions=[],this.incorrectQuestions=[]}get meta(){return this._meta}async init(){const e=await(0,N.getSettings)(this.bus,j);if(!e)return;e.allowTechnicalDataCollection&&x.default.init();const t=new y.default,n=new u.MultiSource;n.add(new f.default,1),n.add(new w.default,2),n.add(new m.default,3),n.add(new p.default,4),n.add(new g.default,5),n.add(new d.default,6),n.add(new h.default,1),await t.load(),await n.load();const i=new u.MultiSource;i.add(n,1),i.add(t,2),t.get("attemptId")!==n.get("attemptId")&&(await v.default.storage.local.remove("magicButtonsState"),j.info("Magic buttons state invalidated"));const s=new _.default(n,t);await s.invalidate()&&(j.info("Attempt context invalidated"),new M.default(_.PARALLEL_ATTEMPTS_WARNING).show(),j.warn("Parallel attempts warning shown")),this._meta={host:i.get("host"),courseId:i.get("courseId"),courseName:i.get("courseName"),quizId:i.get("quizId"),quizName:i.get("quizName"),attemptId:i.get("attemptId"),moodleId:i.get("moodleId")},j.debug("Got page data",(0,z.extras)({pageData:this._meta})),this._meta.host&&(x.default.moodleHost=this._meta.host),await t.saveAttemptData(this._meta),j.info("Page data saved to Local Storage"),this.magicButtonRegistry=new b.MagicButtonRegistry,await this.magicButtonRegistry.init(this.bus);const o=new a.default,r=document.querySelectorAll("div.que");j.info("Begin quiz page parsing..."),j.debug(`Found '${r.length}' .que element(s)`),r.forEach(e=>{if(!(e instanceof HTMLDivElement))return void j.warn("Unexpected DOM element for 'div.que'",(0,z.extras)({html:e.outerHTML}));const t=o.parse(e);t&&(t instanceof A.Parser?this.incorrectQuestions.push(t):this.questions.push(t))}),j.info("End parsing quiz page"),this.initDiagnostics()}async processAttempt(){for(const e of this.questions){const t={questionId:e.id,questionType:e.__type,questionIdentity:e.identity,quizMeta:this._meta};j.info("Requesting solutions",(0,z.extras)({solutionRequest:t})),this.bus.publishToBackground(c.default.SolutionRequest,t).then(t=>{if(t)if(j.info(`Got solutions for question '${e.id}'`,(0,z.extras)({solutions:t})),(0,S.isArray)(t,O.isUnknown))for(const n of t)(0,F.isSolution)(n)?e.handleSolution(n,this.magicButtonRegistry):j.warn("Invalid solution response: unrecognized object",(0,z.extras)({solution:n}));else j.error("Invalid solution response: expected an array but got something else")}).catch(e=>{j.error("Error during solution request",(0,z.extras)({error:e}))}).finally(()=>{const t={message:v.default.i18n.getMessage("noQuestionSolution"),icon:["fa","fa-clock-o"],iconSvg:"clock-o",button:L.default};e.handleOrphans(this.magicButtonRegistry,t)})}j.info(`Got ${this.incorrectQuestions.length} incorrect questions`);for(const e of this.incorrectQuestions){const t={message:v.default.i18n.getMessage("questionNotSupportedMessage"),icon:["fa","fa-wrench"],iconSvg:"wrench",button:k.default};e.handleOrphans(this.magicButtonRegistry,t)}window.addEventListener("beforeunload",e=>{const t={quizMeta:this._meta,questions:this.questions.map(e=>e.serializeToJSON())};this.bus.publishToBackground(c.default.QuizAttemptData,t),j.info("Attempt data published",(0,z.extras)({attemptData:t}))})}async processReview(){const e=document.querySelector("table.quizreviewsummary"),t={quizMeta:this._meta,reviewSummary:e?.innerHTML??null,questions:this.questions.map(e=>e.serializeToJSON())};await this.bus.publishToBackground(c.default.QuizReviewData,t),j.info("Review data published",(0,z.extras)({reviewData:t}))}initDiagnostics(){(new q.BrowserDiagnosticCollector).init(this.bus),(new I.WebLocationDiagnosticCollector).init(this.bus),(new P.PageHtmlDiagnosticCollector).init(this.bus),(0,E.asContentDiagnosticCollector)("quizMeta",async()=>this._meta).init(this.bus)}}!async function(){const e=l.default.getInstance(),t=new C.AuthServiceContent(e),n=new D(e);await n.init(),j.info("Checking page for compatibility...");let i=!0;for(const[e,t]of Object.entries(n.meta))null===n.meta[e]&&(j.warn(`Missing required parameter '${e}'`),i=!1);if(i)if(j.info("Yay, page can be served ^_^"),document.querySelector("#page-mod-quiz-review")){j.info("Serving as a review"),await n.processReview();const e=await t.getAuthData();e?.shortLived&&(await t.logout(),j.info("Logged out by 'short lived' rule"))}else j.info("Serving as an attempt"),await n.processAttempt();else j.info("Sorry, page is not compatible.")}()},8506:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Parser=t.ControlWrapper=void 0;const i=n(67),s=n(4963),o=n(2229),r=n(1641),a=n(4025),l=n(254),c=n(1080);class u{constructor(e){this.options=new Map,this.control=e,this.parent=(0,l.checkNotNull)(this.control.parentElement,"Control's parent is missing"),this.control.childNodes.forEach(e=>{e instanceof HTMLOptionElement&&""!==(0,s.strip)(e.value)&&this.options.set(e.value.toString(),(0,s.strip)(e.innerText))})}setOption(e){if(0===this.options.size)return;const t=[],n=[];for(const[e,i]of this.options.entries())t.push(e),n.push(i);let i=n.indexOf(e);if(-1===i){const t=(0,s.fuzzyMatch)(e,n);if(null===t)return;i=t.index}this.control.value=t[i]}getOptions(){const e=[];for(const t of this.options.values())e.push(t);return e}getUserInput(){const e=this.options.get(this.control.value),t=null==e?"":e,n=(0,i.getStateFromClassList)(this.parent),s=(0,i.getStateFromClassList)(this.control);let o;return o=n===s?n:n===c.State.Unknown?s:s===c.State.Unknown?n:c.State.Unknown,{option:t,state:o}}createWidgetContainer(){const e=document.createElement("span");return this.parent.appendChild(e),e}}t.ControlWrapper=u;class d{constructor(e){this.anchor=[],this.images=[],this._wanded=!1;const t=(0,l.checkNotNull)(e.querySelector(".text"),"Missing .text"),n=(0,l.checkNotNull)(e.querySelector(".control > select"),"Missing .control");this.wrapper=new u(n),this.text=t.innerHTML,this.widgetHost=t.firstElementChild;const i=(0,s.strip)(t.innerText);""!==i&&this.anchor.push(i),this.identity=(0,s.identity)(i),t.querySelectorAll("img").forEach(e=>{const t=(0,o.fromImageElementLazy)(e);this.images.push(t),this.anchor.push((0,a.hashQuestionImage)(t)),this.identity=(0,s.compoundIdentity)(this.identity,(0,s.identity)((0,o.getSrcFilename)(t)));const n=(0,s.extractFilenameFromUrl)(t.src);n&&this.anchor.push(n)})}get wanded(){return this._wanded}serializeToJson(){return{html:this.text,images:this.images,userInput:this.wrapper.getUserInput()}}setOption(e){this.wrapper.setOption(e)}createWidgetContainer(){return this._wanded=!0,null!=this.widgetHost?this.widgetHost:this.wrapper.createWidgetContainer()}getOptions(){return this.wrapper.getOptions()}getAnchor(){return this.anchor}getIdentity(){return this.identity}}class h extends i.Question{constructor(e){super(e),this.subquestions=[],this.formulation=new i.QTextWrapper(e),(0,l.checkNotNull)(this.container.querySelector("table.answer"),"Missing .answer table").querySelectorAll("tr").forEach(e=>{this.subquestions.push(new d(e))})}serializeToJSON(){return{...super.serializeToJSON(),formulation:this.formulation.getFormulation(),subquestions:this.subquestions.map(e=>e.serializeToJson()),options:this.subquestions[0].getOptions(),feedback:this.getFeedback()}}createWidgetAnchor(e){const t=(0,r.fuzzyAnchor)(e,this.subquestions.map(e=>e.getAnchor()));if(-1===t)return null;const n=this.subquestions[t];return{onApply:e=>n.setOption(e),container:n.createWidgetContainer(),appendPosition:"before"}}getOrphanContainers(){const e=[];for(const t of this.subquestions)t.wanded||e.push({container:t.createWidgetContainer(),appendPosition:"before"});return e}get identity(){return(0,s.compoundIdentity)(this.formulation.getIdentity(),...this.subquestions.map(e=>e.getIdentity())).toString()}get autofillSupported(){return!0}getFeedback(){const e=this.container.querySelector("div.feedback");return e instanceof HTMLDivElement?e.innerHTML:null}}t.Parser=h},8911:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Parser=void 0;const i=n(67);class s extends i.Question{constructor(e){super(e),this.wandContainer=this.container.querySelector("div.formulation")??this.container}serializeToJSON(){return{id:-1,__type:"unsupported",behavior:"",state:"",grade:[],identity:""}}getOrphanContainers(){return[{container:this.wandContainer,appendPosition:"after"}]}createWidgetAnchor(){return null}get identity(){return""}get autofillSupported(){return!1}}t.Parser=s},9672:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">\x3c!--!Font Awesome Free v7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--\x3e<path d="M464 256a208 208 0 1 1 -416 0 208 208 0 1 1 416 0zM0 256a256 256 0 1 0 512 0 256 256 0 1 0 -512 0zM232 120l0 136c0 8 4 15.5 10.7 20l96 64c11 7.4 25.9 4.4 33.3-6.7s4.4-25.9-6.7-33.3L280 243.2 280 120c0-13.3-10.7-24-24-24s-24 10.7-24 24z"/></svg>'},9766:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ContextMenu=void 0;const s=i(n(7007)),o=n(1420),r=i(n(1451)),a=(0,o.getGlobalShadowRoot)(),l=(0,o.getExtensionStyle)();a?.append(l);class c extends s.default{get button(){return this._button}constructor(e){super(),this._button=null,this.isShown=!1,this.menu=document.createElement("ul"),this.menu.classList.add("syncshare-cm"),this.menu.hidden=!0,this.constructMenu(this.menu,e),a?.appendChild(this.menu),window.addEventListener("resize",()=>this.hide()),document.addEventListener("click",e=>{e.target!==this.buttonContainer&&this.hide()}),window.addEventListener("scroll",()=>this.hide()),document.querySelector("#overview")?.addEventListener("scroll",()=>this.hide())}constructMenu(e,t){for(const n of t){const t=this.constructOption(n);if(t.addEventListener("click",e=>{e.stopPropagation(),n.subMenu||(this.hide(),this.emit("OptionClick",n),n.action&&n.action(n))}),e.appendChild(t),n.subMenu){const e=document.createElement("ul");e.classList.add("sub-menu"),t.appendChild(e),this.constructMenu(e,n.subMenu)}}}constructOption(e){const t=document.createElement("li");t.classList.add("menu-item");const n=document.createTextNode(e.label),i=document.createElement("span");if(i.classList.add("item-label"),i.appendChild(n),t.appendChild(i),e.icon){const n=e.icon;let s;if(s=n.svg?new r.default(n.svg).element:document.createElement("span"),n.frontColor&&(s.style.color=n.frontColor),n.backColor&&(s.style.backgroundColor=n.backColor),n.text&&!n.svg){const e=document.createTextNode(n.text);s.appendChild(e)}if(n.alignRight){const e=document.createElement("div");e.classList.add("postfix"),s.classList.add("content"),e.appendChild(s),t.appendChild(e)}else s.classList.add("prefix"),t.insertBefore(s,i)}if(e.subMenu&&e.subMenu.length>0){const e=document.createElement("div");e.classList.add("postfix");const n=new r.default("angle-right","","7px","10px").element;e.appendChild(n),t.appendChild(e)}return t}show(e,t){if(this.isShown)return;const{innerWidth:n,innerHeight:i}=window,{offsetWidth:s,offsetHeight:o}=this.menu;let r="0",a="0";this.menu.classList.remove("left"),this.menu.classList.remove("top"),e>=n/4*3&&this.menu.classList.add("left"),t>=i/4*3&&this.menu.classList.add("top"),e>=n-s&&(r="-100%"),t>=i-o&&(a="-100%"),this.menu.style.left=e+"px",this.menu.style.top=t+"px",this.menu.style.transform=`translate(${r}, ${a})`,this.menu.hidden=!1,this.menu.style.setProperty("display","block","important"),this.isShown=!0,this.emit("MenuShown")}hide(){this.isShown&&(this.menu.style.setProperty("display","none","important"),this.menu.hidden=!0,this.isShown=!1,this.emit("MenuHidden"))}attach(e,t){this._button=e,this.buttonContainer=t,e.element.addEventListener("click",e=>{e.preventDefault(),this.show(e.clientX,e.clientY)})}}t.ContextMenu=c},9808:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">\x3c!--!Font Awesome Free v7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--\x3e<path d="M320 0c-17.7 0-32 14.3-32 32s14.3 32 32 32l82.7 0-201.4 201.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L448 109.3 448 192c0 17.7 14.3 32 32 32s32-14.3 32-32l0-160c0-17.7-14.3-32-32-32L320 0zM80 96C35.8 96 0 131.8 0 176L0 432c0 44.2 35.8 80 80 80l256 0c44.2 0 80-35.8 80-80l0-80c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 80c0 8.8-7.2 16-16 16L80 448c-8.8 0-16-7.2-16-16l0-256c0-8.8 7.2-16 16-16l80 0c17.7 0 32-14.3 32-32s-14.3-32-32-32L80 96z"/></svg>'}},n={};function i(e){var s=n[e];if(void 0!==s)return s.exports;var o=n[e]={id:e,loaded:!1,exports:{}};return t[e].call(o.exports,o,o.exports,i),o.loaded=!0,o.exports}i.m=t,e=[],i.O=(t,n,s,o)=>{if(!n){var r=1/0;for(u=0;u<e.length;u++){for(var[n,s,o]=e[u],a=!0,l=0;l<n.length;l++)(!1&o||r>=o)&&Object.keys(i.O).every(e=>i.O[e](n[l]))?n.splice(l--,1):(a=!1,o<r&&(r=o));if(a){e.splice(u--,1);var c=s();void 0!==c&&(t=c)}}return t}o=o||0;for(var u=e.length;u>0&&e[u-1][2]>o;u--)e[u]=e[u-1];e[u]=[n,s,o]},i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.j=726,(()=>{var e={726:0};i.O.j=t=>0===e[t];var t=(t,n)=>{var s,o,[r,a,l]=n,c=0;if(r.some(t=>0!==e[t])){for(s in a)i.o(a,s)&&(i.m[s]=a[s]);if(l)var u=l(i)}for(t&&t(n);c<r.length;c++)o=r[c],i.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return i.O(u)},n=self.webpackChunksyncshare_extension=self.webpackChunksyncshare_extension||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var s=i.O(void 0,[223],()=>i(7996));s=i.O(s)})();