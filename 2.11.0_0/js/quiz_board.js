(()=>{"use strict";var e,t={648:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=i(n(1857)),a=i(n(859)),s=n(183),r=i(n(7011)),l=i(n(6606)),d=i(n(4839)),u=i(n(4945)),c=i(n(6248)),g=i(n(1861)),f=i(n(6077)),p=i(n(3897)),h=n(7214),m=i(n(6815)),y=i(n(2176)),v=n(1530),w=i(n(5045)),b=n(2159),C=n(4139),x=n(4663),M=n(3136),T=n(9977),O=n(3793),L=n(6148),_=n(8004),k=n(1931),z=n(2592),S=n(3118),P=n(2946),j=n(3729),E=S.defaultLogger.child("BoardPage"),q=o.default.getInstance();async function I(e){q.listen(a.default.OpenQuizView,O.isUnknown,()=>{E.info("On open quiz view"),window.open(`https://syncshare.ru/app/quiz/view?moodleHost=${e.host}&quizId=${e.quizId}`)})}!async function(){const e=await(0,j.getSettings)(q,E);if(!e)return;e.allowTechnicalDataCollection&&w.default.init();const t=new C.AuthServiceContent(q),n=new x.FeatureFlagServiceContent(q),i=await n.isEnabled(M.FeatureFlags.Account),o=await n.isEnabled(M.FeatureFlags.AttemptsCount),S=await n.isEnabled(M.FeatureFlags.QuizView);await async function(e){const t=new h.MessageQueue;!async function(e){E.info("Checking for changelog message...");const t=await q.publishToBackground(a.default.GetInstallationMessage);null==t?E.info("No changelog message to show"):(E.info("Found pending changelog message"),e.add(new p.default(t)),e.show())}(t),async function(e,t){const n=await q.publishToBackground(a.default.GetStatusMessage);E.info("Checking for status message...");let i=null;const o=setTimeout(()=>{t.hideNotifications||v.Toast.show({type:"info",message:m.default.i18n.getMessage("checkingStatusContent"),duration:6e3}).then(e=>i=e)},2e3);null==n?(E.info("No status message to show"),null==i?clearTimeout(o):v.Toast.show({type:"success",message:m.default.i18n.getMessage("serviceReachableContent"),duration:8e3})):(E.info("Found pending status message"),clearTimeout(o),e.add(new p.default(n)),e.show())}(t,e),async function(e){E.info("Checking for update message...");const t=await q.publishToBackground(a.default.GetUpdateMessage);null==t?E.info("BoardPage: No update message to show"):(E.info("BoardPage: Found pending update message"),e.add(new p.default(t)),e.show())}(t)}(e);const B=new f.default,H=new s.MultiSource;H.add(new c.default,1),H.add(new g.default,2),H.add(new d.default,3),H.add(new u.default,4),H.add(new r.default,5),H.add(new l.default,1),await H.load(),await B.load();const D=new y.default(H,B);await D.invalidate()&&(E.info("Attempt context invalidated"),await B.load());const N=new s.MultiSource;N.add(H,1),N.add(B,2);const V={host:N.get("host"),courseId:N.get("courseId"),courseName:N.get("courseName"),quizId:N.get("quizId"),quizName:N.get("quizName"),attemptId:N.get("attemptId"),moodleId:N.get("moodleId")};E.debug("Got page data",(0,P.extras)({pageData:V})),V.host&&(w.default.moodleHost=V.host),await B.saveAttemptData(V),E.info("Page data saved to Local Storage"),E.info("Checking page for compatibility...");let A=!0;for(const[e,t]of Object.entries(V))"attemptId"!==e&&null===V[e]&&(E.warn(`Missing parameter '${e}'`),A=!1);if(S&&(E.info("Quiz view feature is enabled"),function(e){e.host&&e.quizId?(E.info("Quiz view feature available"),I(e)):(E.info("Quiz view feature unavailable: missing 'host' & 'quizId'"),q.listen(a.default.OpenQuizView,O.isUnknown,()=>{v.Toast.show({type:"error",message:m.default.i18n.getMessage("quizBoardPageIncompatible"),duration:6e3})}))}(V)),(0,L.asContentDiagnosticCollector)("quizMeta",async()=>V).init(q),(new _.BrowserDiagnosticCollector).init(q),(new k.WebLocationDiagnosticCollector).init(q),(new z.PageHtmlDiagnosticCollector).init(q),A){if(E.info("Yay, page is compatible!"),S&&async function(e){const t=`//*[self::h1 or self::h2 or self::h3 or self::h4][text()[contains(., ${function(e){const t=e?.replace(/'/g,"', \"'\", '");return`concat('${t}', '')`}(e.quizName)})]]`,n=document.evaluate(t,document,null,XPathResult.ANY_TYPE,null).iterateNext();n?(n.setAttribute("style","cursor: pointer;"),n.addEventListener("click",()=>{I(e)}),E.info("Quiz header made clickable")):E.warn("Quiz header is not found!")}(V),null===V.attemptId)E.info("State is 'before attempt'");else{if(E.info("State is 'after attempt'"),await B.clear(),i){const e=await t.getAuthData();e?.shortLived&&(await t.logout(),E.info("Logged out by 'short lived' rule"))}!async function(e){const t=document.querySelector(".quizreviewsummary");let n=null,i=t?.parentElement??null;if(null!==t)for(let e=0;e<5&&null!=i;e++){if(i instanceof HTMLUListElement){n=i;break}i=i?.parentElement}else E.debug("Quiz review sub table not found!");if(null==n){const e=document.querySelector(".quizattemptsummary");if(null!==e)n=e;else{const e=i??document.querySelector("#region-main");E.warn("Quiz review table container not found!",(0,P.extras)({topElementHtml:e?.outerHTML}))}}await q.publishToBackground(a.default.BoardTableData,{quizMeta:e,tableHtml:n?.outerHTML??null})}(V)}i&&(o&&async function(e,t){const n=await q.publishToBackground(a.default.CompletionRequest,{host:e.get("host"),quizId:e.get("quizId")});if((0,T.isCompletionData)(n)&&!t.hideNotifications){const e=n.count;let t;t=e>0?e+"+":e.toString();const i=m.default.i18n.getMessage("quizCompletionMessage").replace("{count}",t);v.Toast.show({type:"info",message:i,duration:6e3})}}(N,e),async function(e,t){const n=(await(0,b.runCatching)(()=>e.getUserData())).getOrNull();n&&1!==n.plan||t.hideNotifications?E.info("Extended status is not available"):(E.info("Extended status is available"),v.Toast.show({type:"info",message:m.default.i18n.getMessage("proStatusNotAvailable"),duration:5e3}))}(t,e))}else E.info("Sorry, page is not compatible.")}()},1530:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Toast=void 0;const o=n(3204),a=n(1420),s=i(n(6815));t.Toast=class{static async show(e){const t=(0,a.getGlobalShadowRoot)();return t?await(0,o.Eggy)({title:s.default.i18n.getMessage("syncshare"),...e,container:t,styleContainer:t}):Promise.reject("Global shadow is not initialized")}static async destroyToast(e){e.classList.add("closing"),setTimeout(()=>{e.remove()},450)}}},1861:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=i(n(980));class a extends o.default{async load(){const e=new URL(this.url?this.url:window.location.href),t=e.searchParams.get("id");this.data.host=e.host,t&&(this.data.quizId=parseInt(t))}}t.default=a},3204:(e,t,n)=>{function i(e,t,n,i,o,a,s){try{var r=e[a](s),l=r.value}catch(e){return void n(e)}r.done?t(l):Promise.resolve(l).then(i,o)}function o(e){return function(){var t=this,n=arguments;return new Promise(function(o,a){var s=e.apply(t,n);function r(e){i(s,o,a,r,l,"next",e)}function l(e){i(s,o,a,r,l,"throw",e)}r(void 0)})}}function a(e,t){var n,i=Object.keys(e);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(e),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,n)),i}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach(function(t){r(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function r(e,t,n){return(t=function(e){return e=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0===t)return String(e);if("object"!=typeof(t=t.call(e,"string")))return t;throw new TypeError("@@toPrimitive must return a primitive value.")}(e),"symbol"==typeof e?e:e+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.r(t),n.d(t,{Eggy:()=>u});class l{constructor(e){this.options=s(s({},this.buildDefaultOptions(e)),e)}create(){var e=this;return o(function*(){yield Promise.all([e.addStyling(),e.addTheme()]);var t=yield e.build();return yield e.bindings(t),setTimeout(()=>{t.classList.add("open")},250),setTimeout(()=>{e.destroyToast(t)},e.options.duration),t})()}build(){var e=this;return o(function*(){var t=yield e.createWrapper(),n=yield e.createToast();return t.appendChild(n),n})()}createToast(){var e=this;return o(function*(){var t,n=document.createElement("div"),i=document.createElement("div");return n.setAttribute("id","eggy-"+Math.random().toString(36).substr(2,4)),n.classList.add(e.options.type),e.options.title&&((t=document.createElement("p")).classList.add("title"),t.innerHTML=e.options.title,i.appendChild(t)),e.options.message&&((t=document.createElement("p")).classList.add("message"),t.innerHTML=e.options.message,i.appendChild(t)),n.innerHTML=yield e.getIconContent(),n.appendChild(i),n.innerHTML+=(yield e.getCloseBtnContent()),e.options.progressBar?e.addProgressBarToToast(n):n})()}destroyToast(e){var t=this;return o(function*(){e.classList.add("closing"),setTimeout(()=>{e.remove(),t.isAlreadyOpen().then(e=>{e&&0==e.childElementCount&&e.remove()})},450)})()}bindings(e){var t=this;return o(function*(){e.querySelector(".close-btn").addEventListener("click",o(function*(){t.destroyToast(e)}))})()}createWrapper(){var e=this;return o(function*(){var t=yield e.isAlreadyOpen();return t||((t=document.createElement("div")).style.zIndex=e.options.zIndex,t.classList.add("eggy",e.options.position),e.options.container.appendChild(t)),t})()}isAlreadyOpen(){var e=this;return o(function*(){return e.options.container.querySelector(".eggy.".concat(e.options.position))||!1})()}getIconContent(){var e=this;return o(function*(){switch(e.options.type){case"success":return'<svg viewBox="0 0 24 24" fill="none"><path fill-rule="evenodd" clip-rule="evenodd" d="M2 12C2 6.48 6.47998 2 12 2C17.52 2 22 6.48 22 12C22 17.52 17.52 22 12 22C6.47998 22 2 17.52 2 12ZM5 12L10 17L19 8L17.59 6.58L10 14.17L6.41003 10.59L5 12Z"></path></svg>';case"info":return'<svg width="24" height="24" viewBox="0 0 24 24" fill="none"><g id="icon/action/info_24px"><path id="icon/action/info_24px_2" fill-rule="evenodd" clip-rule="evenodd" d="M12 2C6.47998 2 2 6.48 2 12C2 17.52 6.47998 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM12 17C11.45 17 11 16.55 11 16V12C11 11.45 11.45 11 12 11C12.55 11 13 11.45 13 12V16C13 16.55 12.55 17 12 17ZM11 7V9H13V7H11Z"></path></g></svg>';case"warning":return'<svg viewBox="0 0 24 24" fill="none"><g id="icon/alert/warning_24px"><path id="icon/alert/warning_24px_2" fill-rule="evenodd" clip-rule="evenodd" d="M19.53 20.5037C21.07 20.5037 22.03 18.8337 21.26 17.5037L13.73 4.49374C12.96 3.16375 11.04 3.16375 10.27 4.49374L2.74001 17.5037C1.96999 18.8337 2.93001 20.5037 4.46999 20.5037H19.53ZM12 13.5037C11.45 13.5037 11 13.0537 11 12.5037V10.5037C11 9.95376 11.45 9.50375 12 9.50375C12.55 9.50375 13 9.95376 13 10.5037V12.5037C13 13.0537 12.55 13.5037 12 13.5037ZM11 15.5037V17.5037H13V15.5037H11Z"></path></g></svg>';case"error":return'<svg viewBox="0 0 24 24" fill="none"><g id="icon/alert/error_24px"><path id="icon/alert/error_24px_2" fill-rule="evenodd" clip-rule="evenodd" d="M12 2C6.47998 2 2 6.48001 2 12C2 17.52 6.47998 22 12 22C17.52 22 22 17.52 22 12C22 6.48001 17.52 2 12 2ZM12 13C11.45 13 11 12.55 11 12V8C11 7.45001 11.45 7 12 7C12.55 7 13 7.45001 13 8V12C13 12.55 12.55 13 12 13ZM11 15V17H13V15H11Z"></path></g></svg>'}})()}getCloseBtnContent(){return o(function*(){return'<svg class="close-btn" viewBox="0 0 24 24" fill="none"><g id="icon/navigation/close_24px"><path id="icon/navigation/close_24px_2" d="M18.3 5.70999C18.1131 5.52273 17.8595 5.4175 17.595 5.4175C17.3305 5.4175 17.0768 5.52273 16.89 5.70999L12 10.59L7.10997 5.69999C6.92314 5.51273 6.66949 5.4075 6.40497 5.4075C6.14045 5.4075 5.8868 5.51273 5.69997 5.69999C5.30997 6.08999 5.30997 6.71999 5.69997 7.10999L10.59 12L5.69997 16.89C5.30997 17.28 5.30997 17.91 5.69997 18.3C6.08997 18.69 6.71997 18.69 7.10997 18.3L12 13.41L16.89 18.3C17.28 18.69 17.91 18.69 18.3 18.3C18.69 17.91 18.69 17.28 18.3 16.89L13.41 12L18.3 7.10999C18.68 6.72999 18.68 6.08999 18.3 5.70999Z"></path></g></svg>'})()}addStyling(){var e=this;return o(function*(){var t;e.options.styleContainer.querySelector(".eggy-styles")||((t=document.createElement("style")).classList.add("eggy-styles"),t.innerHTML=".eggy{max-width:90%;padding:1rem;position:fixed;top:0;width:400px}.eggy,.eggy>div{-webkit-box-sizing:border-box;box-sizing:border-box;overflow:hidden}.eggy>div{background:#fff;border-radius:4px;display:-ms-grid;display:grid;margin-top:10px;max-height:200px;opacity:0;padding:.75rem 1rem;position:relative;-webkit-transition:opacity .3s ease,left .2s ease,right .2s ease,max-height .4s,margin-top .4s,padding .4s;transition:opacity .3s ease,left .2s ease,right .2s ease,max-height .4s,margin-top .4s,padding .4s;width:100%;-ms-grid-columns:1fr 5fr 1fr;grid-template-columns:1fr 5fr 1fr;grid-gap:.5rem;display:-ms-flexbox;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:2}.eggy>div.open{opacity:1}.eggy>div.closing{margin-top:0;max-height:0;opacity:0;padding:0}.eggy.top-right{right:0}.eggy.top-right>div{right:-425px}.eggy.top-right>div.open{right:0}.eggy.top-left{left:0}.eggy.top-left>div{left:-425px}.eggy.top-left>div.open{left:0}",e.options.styleContainer.appendChild(t))})()}addTheme(){var e=this;return o(function*(){var t;!e.options.styleContainer.querySelector(".eggy-theme")&&e.options.styles&&((t=document.createElement("style")).classList.add("eggy-theme"),t.innerHTML="@-webkit-keyframes progressBar{0%{left:0}to{left:-105%}}@keyframes progressBar{0%{left:0}to{left:-105%}}.eggy>div.success{border:2px solid #61c9a8}.eggy>div.success svg:first-of-type{fill:#61c9a8}.eggy>div.warning{border:2px solid #ed9b40}.eggy>div.warning svg:first-of-type{fill:#ed9b40}.eggy>div.info{border:2px solid #40a2ed}.eggy>div.info svg:first-of-type{fill:#40a2ed}.eggy>div.error{border:2px solid #d64550}.eggy>div.error svg:first-of-type{fill:#d64550}.eggy>div svg:first-of-type{width:30px;z-index:2}.eggy>div svg:last-of-type{width:25px;z-index:2;fill:#8d8d8d;-ms-grid-column-align:center;cursor:pointer;justify-self:center;margin-left:auto}.eggy>div>div .message,.eggy>div>div .title{color:#404040;margin:.1rem 0}.eggy>div>div .message.title,.eggy>div>div .title.title{font-size:.9rem;font-weight:700}.eggy>div>div .message.message,.eggy>div>div .title.message{font-size:.8rem;font-weight:400}",e.options.styleContainer.appendChild(t))})()}addProgressBarToToast(e){var t=this;return o(function*(){var n,i=document.createElement("span"),o=t.options.duration/1e3;return i.classList.add("progress-bar"),e.appendChild(i),t.options.styles&&(i=e.getAttribute("id"),(n=document.createElement("style")).innerHTML=".eggy>div .progress-bar{-webkit-animation-fill-mode:forwards;animation-fill-mode:forwards;-webkit-animation-name:progressBar;animation-name:progressBar;-webkit-animation-timing-function:linear;animation-timing-function:linear;clip-path:polygon(0 0,100% 0,95% 100%,0 100%);height:100%;position:absolute;top:0;width:105%;z-index:1}.eggy>div.success>.progress-bar{background-color:rgba(97,201,168,.1)}.eggy>div.warning>.progress-bar{background-color:rgba(237,155,64,.1)}.eggy>div.info>.progress-bar{background-color:rgba(64,162,237,.1)}.eggy>div.error>.progress-bar{background-color:rgba(214,69,80,.1)}",n.innerHTML+="#".concat(i," > .progress-bar { animation-duration: ").concat(o,"s }"),e.appendChild(n)),e})()}buildDefaultOptions(e){var t={position:"top-right",type:"success",styles:!0,duration:5e3,progressBar:!0,zIndex:100500,container:document.body,styleContainer:document.head};switch(null!=e&&null!=(e=e.type)?e:t.type){case"success":t.title="Success!",t.message="Task successfully completed.";break;case"info":t.title="Information",t.message="Please take note of this information.";break;case"warning":t.title="Warning",t.message="Please be careful!";break;case"error":t.title="Whoops!",t.message="Something wen't wrong, please try again!"}return t}}var d,u=(d=o(function*(e){return yield new l(e).create()}),function(e){return d.apply(this,arguments)})},4839:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=i(n(840));class a extends o.default{constructor(){super(),this.url=document.referrer}}t.default=a},7214:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MessageQueue=void 0,t.MessageQueue=class{constructor(){this.queue=[],this.isShowing=!1}add(e,t=0){if(t<0)throw Error("Message delay must be positive number");this.queue.push({message:e,delay:t})}showNext(){const e=this.queue.pop();void 0!==e?(e.message.on("dismiss",()=>{this.showNext()}),e.message.show()):this.isShowing=!1}show(){this.isShowing||(this.showNext(),this.isShowing=!0)}}}},n={};function i(e){var o=n[e];if(void 0!==o)return o.exports;var a=n[e]={id:e,loaded:!1,exports:{}};return t[e].call(a.exports,a,a.exports,i),a.loaded=!0,a.exports}i.m=t,e=[],i.O=(t,n,o,a)=>{if(!n){var s=1/0;for(u=0;u<e.length;u++){for(var[n,o,a]=e[u],r=!0,l=0;l<n.length;l++)(!1&a||s>=a)&&Object.keys(i.O).every(e=>i.O[e](n[l]))?n.splice(l--,1):(r=!1,a<s&&(s=a));if(r){e.splice(u--,1);var d=o();void 0!==d&&(t=d)}}return t}a=a||0;for(var u=e.length;u>0&&e[u-1][2]>a;u--)e[u]=e[u-1];e[u]=[n,o,a]},i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.j=741,(()=>{var e={741:0};i.O.j=t=>0===e[t];var t=(t,n)=>{var o,a,[s,r,l]=n,d=0;if(s.some(t=>0!==e[t])){for(o in r)i.o(r,o)&&(i.m[o]=r[o]);if(l)var u=l(i)}for(t&&t(n);d<s.length;d++)a=s[d],i.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return i.O(u)},n=self.webpackChunksyncshare_extension=self.webpackChunksyncshare_extension||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var o=i.O(void 0,[223],()=>i(648));o=i.O(o)})();